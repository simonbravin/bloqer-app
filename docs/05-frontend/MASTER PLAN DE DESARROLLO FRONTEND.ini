ğŸ—ï¸ MASTER PLAN DE DESARROLLO FRONTEND
Bloqer - Multi-tenant SaaS
ğŸ“‹ ANÃLISIS DE SITUACIÃ“N ACTUAL
âœ… Lo que YA tienes implementado (Backend):
SegÃºn el contexto de la conversaciÃ³n:
1.	âœ… Auth + Multi-tenancy (Prompts 1-4) 
o	Login/Register
o	Organizations + OrgMembers
o	Sessions con next-auth v5
o	Middleware de protecciÃ³n
2.	âœ… Projects + WBS (Prompts 5-8) 
o	CRUD de proyectos
o	WBS hierarchical (PHASE â†’ ACTIVITY â†’ TASK)
o	CÃ³digos auto-generados (1, 1.1, 1.1.1)
3.	âœ… Budget Management (Prompts 9-10 + 18) 
o	Budget Versions (INITIAL, BASELINE, APPROVED, WORKING)
o	Budget Lines con recursos
o	Planilla de CÃ³mputo (APU - AnÃ¡lisis de Precio Unitario)
o	CÃ¡lculos de costos directos + indirectos
o	Formato ARS (Argentina)
4.	âœ… Change Orders (Prompt 11) 
o	Workflow DRAFT â†’ SUBMITTED â†’ APPROVED/REJECTED
o	Auto-generaciÃ³n de nÃºmeros
o	CreaciÃ³n de nueva versiÃ³n de presupuesto al aprobar
5.	âœ… Finance Transactions (Prompt 12) 
o	Multi-currency con exchange rates
o	Tipos: INVOICE_RECEIVED, PAYMENT_MADE, EXPENSE, etc
o	Link a WBS items para tracking de costos
6.	âœ… Certifications (Prompt 13) 
o	Progress billing
o	Certificaciones inmutables con integrity seal
o	CÃ¡lculo de avance (previous + period = total)
7.	âœ… Documents (Prompt 14) 
o	Versioning de documentos
o	Upload a Cloudflare R2
o	Checksums SHA-256
o	Links a entidades
8.	âœ… RFI + Submittals (Prompt 15) 
o	RFI workflow
o	Submittal approval process
9.	âœ… Global Suppliers (Prompt 15.bis) 
o	Directorio global de proveedores
o	OrgPartyLink (link org â†’ global)
o	Reviews y ratings
o	Claims workflow
10.	âœ… Inventory (Prompt 16) 
o	Ledger-based stock tracking
o	Movimientos de inventario
o	Locations (warehouse, project site)
11.	âœ… Reports + Templates (Prompt 17) 
o	Saved reports
o	Templates con merge fields
o	Export runs (background jobs)
12.	âœ… i18n (EspaÃ±ol/InglÃ©s) 
o	next-intl configurado
o	EspaÃ±ol (es-AR) como default
o	Formato de moneda ARS
o	IVA 21%
âš ï¸ Problemas actuales identificados:
1.	Textos hardcodeados en inglÃ©s - Muchos componentes tienen strings sin traducir
2.	Frontend incompleto - Backend funcional pero UI bÃ¡sica/incompleta
3.	Sin navegaciÃ³n dual - No hay diferenciaciÃ³n entre contexto global vs proyecto
________________________________________
ğŸ¯ OBJETIVO DEL PLAN
Desarrollar el frontend completo con:
1.	NavegaciÃ³n dual (Contexto Org vs Contexto Proyecto)
2.	UI/UX profesional estilo Procore/Buildertrend
3.	Componentes reutilizables con shadcn/ui
4.	Traducciones completas (es-AR default)
5.	Responsivo (mobile-first donde aplique)
6.	Performance (lazy loading, optimistic updates)
________________________________________
ğŸ“ ARQUITECTURA DE NAVEGACIÃ“N
DecisiÃ³n clave: Layout DinÃ¡mico
El sistema tiene DOS contextos de navegaciÃ³n:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ROOT LAYOUT (apps/web/app/[locale]/layout.tsx)     â”‚
â”‚ - Auth Provider                                     â”‚
â”‚ - Theme Provider                                    â”‚
â”‚ - i18n Provider                                     â”‚
â”‚ - TanStack Query Provider                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”œâ”€â”€â”€ (auth) - Login/Register
                       â”‚
                       â””â”€â”€â”€ (dashboard) â”€â”€â”
                                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GLOBAL CONTEXT   â”‚                                     â”‚  PROJECT CONTEXT          â”‚
â”‚                  â”‚                                     â”‚                           â”‚
â”‚ Layout: Global   â”‚                                     â”‚  Layout: Project          â”‚
â”‚ Sidebar:         â”‚                                     â”‚  Sidebar:                 â”‚
â”‚ - Dashboard      â”‚                                     â”‚  - Dashboard Proyecto     â”‚
â”‚ - Proyectos      â”‚                                     â”‚  - Presupuesto           â”‚
â”‚ - Equipo         â”‚                                     â”‚  - Cronograma            â”‚
â”‚ - Inventario     â”‚                                     â”‚  - Finanzas              â”‚
â”‚ - Proveedores    â”‚                                     â”‚  - Certificaciones       â”‚
â”‚ - Documentos     â”‚                                     â”‚  - Calidad (RFI)         â”‚
â”‚ - ConfiguraciÃ³n  â”‚                                     â”‚  - Libro de Obra         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚  - Documentos            â”‚
                                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Estructura de Rutas en App Router
apps/web/app/[locale]
â”‚
â”œâ”€â”€ (auth)/
â”‚   â”œâ”€â”€ login/page.tsx
â”‚   â”œâ”€â”€ register/page.tsx
â”‚   â””â”€â”€ layout.tsx (sin sidebar)
â”‚
â””â”€â”€ (dashboard)/
    â”œâ”€â”€ layout.tsx (elige sidebar dinÃ¡micamente)
    â”‚
    â”œâ”€â”€ dashboard/page.tsx (Global Dashboard)
    â”œâ”€â”€ projects/page.tsx (Lista de proyectos)
    â”œâ”€â”€ team/page.tsx (Equipo de la org)
    â”œâ”€â”€ inventory/page.tsx (Inventario central)
    â”œâ”€â”€ suppliers/
    â”‚   â”œâ”€â”€ page.tsx (Mis proveedores)
    â”‚   â””â”€â”€ global/page.tsx (Directorio global)
    â”œâ”€â”€ documents/page.tsx (Documentos org)
    â”œâ”€â”€ settings/page.tsx
    â”‚
    â””â”€â”€ projects/[id]/
        â”œâ”€â”€ layout.tsx (PROJECT LAYOUT - cambia sidebar)
        â”œâ”€â”€ page.tsx (Dashboard del proyecto)
        â”œâ”€â”€ budget/
        â”‚   â”œâ”€â”€ page.tsx (Lista versiones)
        â”‚   â”œâ”€â”€ [versionId]/
        â”‚   â”‚   â”œâ”€â”€ page.tsx (Detalle versiÃ³n)
        â”‚   â”‚   â””â”€â”€ compute/page.tsx (Planilla de cÃ³mputo)
        â”‚   â””â”€â”€ new/page.tsx
        â”œâ”€â”€ wbs/page.tsx
        â”œâ”€â”€ change-orders/
        â”‚   â”œâ”€â”€ page.tsx
        â”‚   â”œâ”€â”€ [id]/page.tsx
        â”‚   â””â”€â”€ new/page.tsx
        â”œâ”€â”€ finance/
        â”‚   â”œâ”€â”€ transactions/page.tsx
        â”‚   â”œâ”€â”€ certifications/page.tsx
        â”‚   â””â”€â”€ cashflow/page.tsx
        â”œâ”€â”€ schedule/page.tsx (Gantt)
        â”œâ”€â”€ quality/
        â”‚   â”œâ”€â”€ rfis/page.tsx
        â”‚   â””â”€â”€ submittals/page.tsx
        â”œâ”€â”€ daily-reports/page.tsx
        â”œâ”€â”€ documents/page.tsx
        â””â”€â”€ settings/page.tsx
________________________________________
ğŸ¨ ESTRATEGIA DE UI/UX
Paleta de Colores: "Midnight & Slate"
typescript
// apps/web/app/globals.css
:root {
  /* Primary - Navy/Midnight Blue */
  --primary-50: 240 249 255;
  --primary-100: 224 242 254;
  --primary-200: 186 230 253;
  --primary-500: 14 165 233; // Sky blue
  --primary-600: 2 132 199;
  --primary-700: 3 105 161;
  --primary-900: 12 74 110; // Navy para sidebar
  
  /* Neutral - Slate */
  --slate-50: 248 250 252;
  --slate-100: 241 245 249;
  --slate-200: 226 232 240;
  --slate-700: 51 65 85;
  --slate-900: 15 23 42;
  
  /* Semantic Colors */
  --success: 34 197 94; // Green
  --warning: 251 146 60; // Orange
  --danger: 239 68 68; // Red
  --info: 59 130 246; // Blue
}
Layout Components EstÃ¡ndar
1. PageHeader Component
typescript
// components/layout/page-header.tsx
interface PageHeaderProps {
  title: string
  subtitle?: string
  breadcrumbs?: Array<{ label: string; href?: string }>
  actions?: React.ReactNode
  filters?: React.ReactNode
}

export function PageHeader({
  title,
  subtitle,
  breadcrumbs,
  actions,
  filters
}: PageHeaderProps) {
  return (
    <div className="border-b border-slate-200 bg-white px-6 py-4">
      {breadcrumbs && <Breadcrumbs items={breadcrumbs} />}
      
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-semibold text-slate-900">{title}</h1>
          {subtitle && (
            <p className="mt-1 text-sm text-slate-500">{subtitle}</p>
          )}
        </div>
        
        {actions && (
          <div className="flex items-center gap-2">{actions}</div>
        )}
      </div>
      
      {filters && (
        <div className="mt-4">{filters}</div>
      )}
    </div>
  )
}
2. Dynamic Sidebar
typescript
// components/layout/dynamic-sidebar.tsx
'use client'

import { usePathname } from 'next/navigation'
import { GlobalNavigation } from './global-navigation'
import { ProjectNavigation } from './project-navigation'

export function DynamicSidebar() {
  const pathname = usePathname()
  
  // Si estamos en un proyecto, mostrar navegaciÃ³n de proyecto
  const isProjectContext = pathname.includes('/projects/') && 
                           pathname.split('/').length > 4
  
  if (isProjectContext) {
    const projectId = pathname.split('/')[3] // /es/projects/[id]/...
    return <ProjectNavigation projectId={projectId} />
  }
  
  return <GlobalNavigation />
}
3. Breadcrumbs DinÃ¡micos
typescript
// components/layout/breadcrumbs.tsx
'use client'

import { usePathname } from 'next/navigation'
import { useTranslations } from 'next-intl'
import Link from 'next/link'

export function DynamicBreadcrumbs() {
  const pathname = usePathname()
  const t = useTranslations('navigation')
  
  const segments = pathname.split('/').filter(Boolean)
  
  // Generar breadcrumbs automÃ¡ticamente
  const breadcrumbs = segments.map((segment, index) => {
    const href = '/' + segments.slice(0, index + 1).join('/')
    const label = translateSegment(segment, t)
    
    return { label, href }
  })
  
  return (
    <nav className="flex" aria-label="Breadcrumb">
      {breadcrumbs.map((crumb, i) => (
        <div key={i} className="flex items-center">
          {i > 0 && <span className="mx-2 text-slate-400">/</span>}
          {i === breadcrumbs.length - 1 ? (
            <span className="font-medium text-slate-900">{crumb.label}</span>
          ) : (
            <Link href={crumb.href} className="text-slate-600 hover:text-slate-900">
              {crumb.label}
            </Link>
          )}
        </div>
      ))}
    </nav>
  )
}
________________________________________
ğŸ“¦ MÃ“DULOS Y COMPONENTES CLAVE
MÃ³dulo 1: Perfil y ConfiguraciÃ³n
Rutas:
â€¢	/settings/organization - Datos de la org
â€¢	/settings/profile - Perfil del usuario
â€¢	/settings/team - GestiÃ³n de equipo
â€¢	/settings/billing - FacturaciÃ³n (future)
Componentes Principales:
typescript
// 1. OrganizationSettingsForm
components/settings/organization-settings-form.tsx
- EdiciÃ³n de datos fiscales
- Logo upload (R2)
- Moneda base
- Timezone

// 2. UserProfileForm
components/settings/user-profile-form.tsx
- Datos personales
- Avatar upload
- Preferencias de idioma

// 3. TeamManagement
components/settings/team-management.tsx
- Lista de miembros (tabla)
- Invitar usuario (modal)
- Editar roles
- Desactivar usuario

// 4. InvitationFlow
components/settings/invitation-flow.tsx
- Form: email + role
- Estado PENDING en OrgMember
- Email con link de registro
- Auto-join al registrarse
Server Actions:
typescript
// app/actions/settings.ts
- updateOrganization()
- updateUserProfile()
- inviteTeamMember() // Creates OrgMember PENDING
- updateMemberRole()
- deactivateMember()
LÃ³gica UX CrÃ­tica:
typescript
// Flujo de InvitaciÃ³n:
1. Admin invita a pepe@gmail.com como PROJECT_MANAGER
2. Se crea OrgMember con status=PENDING
3. Email enviado con token
4. Pepe se registra o hace login
5. Sistema detecta invitaciÃ³n pendiente (por email)
6. Auto-join: OrgMember.status = ACTIVE
7. Redirect a dashboard del org
________________________________________
MÃ³dulo 2: Dashboard Global
Ruta: /dashboard
Componentes:
typescript
// 1. KPICards
components/dashboard/kpi-cards.tsx
- Total proyectos activos
- Presupuesto total en curso
- Certificaciones pendientes
- Gastos del mes

// 2. CashflowChart
components/dashboard/cashflow-chart.tsx
- GrÃ¡fico de flujo de caja proyectado vs real
- Ãšltimos 6 meses
- Using Recharts

// 3. AlertsWidget
components/dashboard/alerts-widget.tsx
- Presupuestos cerca del lÃ­mite
- Certificaciones vencidas
- RFIs sin responder
- Inventario bajo stock mÃ­nimo

// 4. RecentActivity
components/dashboard/recent-activity.tsx
- Feed de actividad reciente
- Aprobaciones pendientes
- Cambios importantes
Server Actions:
typescript
// app/actions/dashboard.ts
- getOrgKPIs()
- getCashflowData()
- getAlerts()
- getRecentActivity()
________________________________________
MÃ³dulo 3: Proyectos (Global View)
Ruta: /projects
Componentes:
typescript
// 1. ProjectsListTable
components/projects/projects-list-table.tsx
- Tabla con TanStack Table
- Columnas: NÃºmero, Nombre, Cliente, Fase, Estado, Presupuesto, Avance
- Filtros: Estado, Fase, BÃºsqueda
- Sorting server-side

// 2. ProjectCard (alternative view)
components/projects/project-card.tsx
- Vista grid de cards
- Toggle entre table/grid

// 3. ProjectForm
components/projects/project-form.tsx
- Create/Edit project
- react-hook-form + Zod
- Custom fields dinÃ¡micos

// 4. ProjectStatusBadge
components/projects/project-status-badge.tsx
- Badge con colores semÃ¡nticos
Server Actions:
typescript
// app/actions/projects.ts (YA EXISTE - revisar)
- listProjects(filters)
- getProject(id)
- createProject(data)
- updateProject(id, data)
- deleteProject(id)
________________________________________
MÃ³dulo 4: Presupuesto (CORE)
Rutas:
â€¢	/projects/[id]/budget - Lista de versiones
â€¢	/projects/[id]/budget/[versionId] - Detalle versiÃ³n
â€¢	/projects/[id]/budget/[versionId]/compute - Planilla de cÃ³mputo
Componentes:
typescript
// 1. BudgetVersionList
components/budget/budget-version-list.tsx
- Tabla de versiones
- Acciones: Set Baseline, Approve, Copy
- Status badges

// 2. BudgetTreeTable (Modo Admin)
components/budget/budget-tree-table.tsx
- Ãrbol jerÃ¡rquico (WBS + Budget Lines)
- Columnas: CÃ³digo WBS, DescripciÃ³n, Unidad, Cantidad, Costo Directo, GG%, Beneficio%, Precio Venta, Total
- Expandir/colapsar por WBS
- Editable inline (solo DRAFT)
- Totales por WBS (rollup)

// 3. BudgetTreeTable (Modo Cliente)
components/budget/budget-tree-table-client.tsx
- Misma estructura PERO:
- Oculta: Costo Directo, GG%, Beneficio%
- Muestra solo: Precio Venta unitario + Total
- Toggle "Mostrar desglose" (ADMIN only)

// 4. ComputeSheetView (YA EXISTE - revisar)
components/budget/compute-sheet-view.tsx
- Planilla de cÃ³mputo tradicional
- CÃ³digo, DescripciÃ³n, Unidad, Cantidad, P.U., Subtotal
- APU modal al click

// 5. APUDetailModal (YA EXISTE - revisar)
components/budget/apu-detail-modal.tsx
- Desglose de recursos
- Costo directo + Indirectos = P.U. Total

// 6. MaterialBreakdown
components/budget/material-breakdown.tsx
- Lista de materiales agrupados
- Cantidades totales
- Para generar Ã³rdenes de compra

// 7. LaborBreakdown
components/budget/labor-breakdown.tsx
- Mano de obra por especialidad
- Horas totales
Server Actions:
typescript
// app/actions/budget.ts (YA EXISTE - revisar y extender)
- listBudgetVersions(projectId)
- getBudgetVersion(versionId)
- createBudgetVersion(data)
- copyBudgetVersion(versionId)
- setBaseline(versionId)
- approveBudgetVersion(versionId)
- addBudgetLine(versionId, data)
- updateBudgetLine(lineId, data)
- deleteBudgetLine(lineId)
- getAPUDetail(lineId) // YA EXISTE
- getMaterialSummary(versionId)
- getLaborSummary(versionId)
LÃ³gica UX CrÃ­tica - Markups:
typescript
// CÃ¡lculo en tiempo real (client-side preview, server-side save)
const calculatePrice = (budgetLine: BudgetLine) => {
  const directCost = budgetLine.directCostTotal
  const overhead = directCost * (budgetLine.overheadPct / 100)
  const financial = (directCost + overhead) * (budgetLine.financialPct / 100)
  const subtotal = directCost + overhead + financial
  const profit = subtotal * (budgetLine.profitPct / 100)
  const preTax = subtotal + profit
  const tax = preTax * (budgetLine.taxPct / 100)
  const salePrice = preTax + tax
  
  return {
    directCost,
    overhead,
    financial,
    profit,
    tax,
    salePrice
  }
}
Modo Admin vs Cliente:
typescript
// En budget version page
const [viewMode, setViewMode] = useState<'admin' | 'client'>('admin')

// Solo ADMIN/OWNER pueden ver modo admin
const canSeeAdminMode = ['ADMIN', 'OWNER'].includes(userRole)

{canSeeAdminMode && (
  <Toggle
    value={viewMode}
    onChange={setViewMode}
    options={[
      { value: 'admin', label: 'Vista Completa' },
      { value: 'client', label: 'Vista Cliente' }
    ]}
  />
)}

{viewMode === 'admin' ? (
  <BudgetTreeTable data={budgetData} editable={isEditable} />
) : (
  <BudgetTreeTableClient data={budgetData} />
)}
________________________________________
MÃ³dulo 5: Gastos (Finance)
Rutas:
â€¢	/projects/[id]/finance/transactions - Lista de transacciones
â€¢	/projects/[id]/finance/transactions/[id] - Detalle
â€¢	/projects/[id]/finance/transactions/new - Nueva
Componentes:
typescript
// 1. TransactionsList (YA EXISTE - revisar)
components/finance/transactions-list.tsx
- Tabla filtrable
- Por tipo, estado, proyecto
- BÃºsqueda

// 2. TransactionForm (YA EXISTE - revisar)
components/finance/transaction-form.tsx
- Tipo de transacciÃ³n
- Multi-currency selector
- Exchange rate
- Lines (imputaciÃ³n a WBS)
- Proveedor (Party selector)

// 3. TransactionDetail
components/finance/transaction-detail.tsx
- Header con info
- Lines table
- Workflow actions (Submit, Approve, Void)
- Link a documentos adjuntos

// 4. ImputationToWBS
components/finance/imputation-to-wbs.tsx
- Selector de WBS item
- Cantidad
- Monto
- Permite mÃºltiples lÃ­neas
Server Actions:
typescript
// app/actions/finance.ts (YA EXISTE - revisar)
- listTransactions(filters)
- getTransaction(id)
- createTransaction(data)
- submitTransaction(id)
- approveTransaction(id)
- voidTransaction(id, reason)
________________________________________
ContinÃºo con los mÃ³dulos restantes en mi siguiente mensaje para no exceder el lÃ­mite de tokens.
Â¿Quieres que continÃºe con:
â€¢	Compromisos (Ã“rdenes de Compra)
â€¢	Certificaciones
â€¢	Cashflow
â€¢	Inventario
â€¢	Proveedores
â€¢	Documentos
â€¢	Plan de Trabajo (Gantt)
â€¢	Libro de Obra
â€¢	Reportes
O prefieres que primero armemos los PROMPTS EJECUTABLES para Cursor con lo que ya tenemos?
â€ƒ
â€ƒ
ğŸš€ PROMPTS EJECUTABLES PARA CURSOR
Frontend Completo - Bloqer
________________________________________
PROMPT 19: NavegaciÃ³n Dual - Layouts DinÃ¡micos
Goal: Implementar sistema de navegaciÃ³n dual con sidebar que cambia segÃºn contexto (Global vs Proyecto).
Context:
El sistema necesita dos contextos de navegaciÃ³n distintos:
1.	Contexto Global: Para gestiÃ³n a nivel organizaciÃ³n (Dashboard, Proyectos, Equipo, Inventario, Proveedores)
2.	Contexto Proyecto: Para gestiÃ³n especÃ­fica de un proyecto (Presupuesto, Cronograma, Finanzas, RFIs, etc.)
El sidebar debe cambiar dinÃ¡micamente segÃºn la ruta actual.
IMPORTANTE - NO MODIFICAR:
â€¢	âŒ No tocar archivos de server actions en app/actions/
â€¢	âŒ No modificar lÃ³gica de backend existente
â€¢	âŒ No cambiar rutas ya creadas (solo agregar nuevas si es necesario)
â€¢	âœ… Usar traducciones desde messages/es.json (ya configurado)
â€¢	âœ… Aprovechar componentes de shadcn/ui existentes
Requisitos:
1. Crear Layout Base Dashboard
File: app/[locale]/(dashboard)/layout.tsx
Debe:
â€¢	Detectar si estamos en contexto global o de proyecto
â€¢	Renderizar sidebar correspondiente
â€¢	Incluir header con breadcrumbs
â€¢	Incluir user menu dropdown
â€¢	Ser responsive (mobile hamburger menu)
typescript
import { getSession } from '@/lib/session'
import { getOrgContext } from '@/lib/org-context'
import { redirect } from 'next/navigation'
import { DynamicSidebar } from '@/components/layout/dynamic-sidebar'
import { DashboardHeader } from '@/components/layout/dashboard-header'
import { DynamicBreadcrumbs } from '@/components/layout/dynamic-breadcrumbs'

export default async function DashboardLayout({
  children,
  params,
}: {
  children: React.ReactNode
  params: { locale: string }
}) {
  const session = await getSession()
  if (!session?.user?.id) redirect(`/${params.locale}/login`)
  
  const orgContext = await getOrgContext(session.user.id)
  if (!orgContext) redirect(`/${params.locale}/login`)
  
  return (
    <div className="flex h-screen bg-slate-50">
      {/* Sidebar - cambia segÃºn contexto */}
      <DynamicSidebar />
      
      {/* Main content */}
      <div className="flex flex-1 flex-col overflow-hidden">
        {/* Header */}
        <DashboardHeader 
          user={session.user} 
          orgName={orgContext.orgName}
        />
        
        {/* Breadcrumbs */}
        <div className="border-b bg-white px-6 py-3">
          <DynamicBreadcrumbs />
        </div>
        
        {/* Page content */}
        <main className="flex-1 overflow-y-auto">
          {children}
        </main>
      </div>
    </div>
  )
}
2. Crear Sidebar DinÃ¡mico
File: components/layout/dynamic-sidebar.tsx
typescript
'use client'

import { usePathname } from 'next/navigation'
import { GlobalSidebar } from './global-sidebar'
import { ProjectSidebar } from './project-sidebar'

export function DynamicSidebar() {
  const pathname = usePathname()
  
  // Detectar si estamos en un proyecto especÃ­fico
  // Formato: /es/projects/[uuid]/...
  const projectMatch = pathname.match(/\/projects\/([^\/]+)\//)
  const projectId = projectMatch?.[1]
  
  // Si estamos en una ruta de proyecto (no en /projects listado)
  const isProjectContext = projectId && pathname.split('/').length > 4
  
  if (isProjectContext) {
    return <ProjectSidebar projectId={projectId} />
  }
  
  return <GlobalSidebar />
}
3. Crear Global Sidebar
File: components/layout/global-sidebar.tsx
typescript
'use client'

import { useTranslations } from 'next-intl'
import { Link } from '@/i18n/navigation'
import { usePathname } from 'next/navigation'
import {
  LayoutDashboard,
  FolderKanban,
  Users,
  Package,
  Building2,
  FileText,
  Settings,
} from 'lucide-react'

export function GlobalSidebar() {
  const t = useTranslations('nav')
  const pathname = usePathname()
  
  const navigation = [
    {
      name: t('dashboard'),
      href: '/dashboard',
      icon: LayoutDashboard,
    },
    {
      name: t('projects'),
      href: '/projects',
      icon: FolderKanban,
    },
    {
      name: t('team'),
      href: '/team',
      icon: Users,
    },
    {
      name: t('inventory'),
      href: '/inventory',
      icon: Package,
    },
    {
      name: t('suppliers'),
      href: '/suppliers',
      icon: Building2,
    },
    {
      name: t('documents'),
      href: '/documents',
      icon: FileText,
    },
    {
      name: t('settings'),
      href: '/settings',
      icon: Settings,
    },
  ]
  
  return (
    <aside className="flex w-64 flex-col bg-slate-900">
      {/* Logo */}
      <div className="flex h-16 items-center px-6">
        <span className="text-xl font-bold text-white">
          Bloqer
        </span>
      </div>
      
      {/* Navigation */}
      <nav className="flex-1 space-y-1 px-3 py-4">
        {navigation.map((item) => {
          const isActive = pathname === item.href || pathname.startsWith(item.href + '/')
          
          return (
            <Link
              key={item.name}
              href={item.href}
              className={`
                flex items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium transition-colors
                ${isActive 
                  ? 'bg-slate-800 text-white' 
                  : 'text-slate-300 hover:bg-slate-800 hover:text-white'
                }
              `}
            >
              <item.icon className="h-5 w-5" />
              {item.name}
            </Link>
          )
        })}
      </nav>
      
      {/* Footer */}
      <div className="border-t border-slate-800 p-4">
        <p className="text-xs text-slate-400">
          Â© 2025 Bloqer
        </p>
      </div>
    </aside>
  )
}
4. Crear Project Sidebar
File: components/layout/project-sidebar.tsx
typescript
'use client'

import { useTranslations } from 'next-intl'
import { Link } from '@/i18n/navigation'
import { usePathname } from 'next/navigation'
import { useEffect, useState } from 'react'
import {
  LayoutDashboard,
  DollarSign,
  Calendar,
  Receipt,
  CheckSquare,
  FileText,
  ClipboardList,
  ArrowLeft,
} from 'lucide-react'

interface ProjectSidebarProps {
  projectId: string
}

export function ProjectSidebar({ projectId }: ProjectSidebarProps) {
  const t = useTranslations('nav')
  const pathname = usePathname()
  const [projectName, setProjectName] = useState('')
  
  // Fetch project name
  useEffect(() => {
    fetch(`/api/projects/${projectId}`)
      .then(res => res.json())
      .then(data => setProjectName(data.name))
      .catch(() => setProjectName('Proyecto'))
  }, [projectId])
  
  const navigation = [
    {
      name: t('projectDashboard'),
      href: `/projects/${projectId}`,
      icon: LayoutDashboard,
      exact: true,
    },
    {
      name: t('budget'),
      href: `/projects/${projectId}/budget`,
      icon: DollarSign,
    },
    {
      name: t('schedule'),
      href: `/projects/${projectId}/schedule`,
      icon: Calendar,
    },
    {
      name: t('finance'),
      href: `/projects/${projectId}/finance`,
      icon: Receipt,
      children: [
        {
          name: t('transactions'),
          href: `/projects/${projectId}/finance/transactions`,
        },
        {
          name: t('certifications'),
          href: `/projects/${projectId}/certifications`,
        },
      ],
    },
    {
      name: t('quality'),
      href: `/projects/${projectId}/quality`,
      icon: CheckSquare,
      children: [
        {
          name: t('rfis'),
          href: `/projects/${projectId}/quality/rfis`,
        },
        {
          name: t('submittals'),
          href: `/projects/${projectId}/quality/submittals`,
        },
      ],
    },
    {
      name: t('dailyReports'),
      href: `/projects/${projectId}/daily-reports`,
      icon: ClipboardList,
    },
    {
      name: t('documents'),
      href: `/projects/${projectId}/documents`,
      icon: FileText,
    },
  ]
  
  return (
    <aside className="flex w-64 flex-col bg-slate-900">
      {/* Back to projects */}
      <div className="flex h-16 items-center border-b border-slate-800 px-6">
        <Link
          href="/projects"
          className="flex items-center gap-2 text-sm text-slate-300 hover:text-white"
        >
          <ArrowLeft className="h-4 w-4" />
          {t('backToProjects')}
        </Link>
      </div>
      
      {/* Project name */}
      <div className="border-b border-slate-800 px-6 py-4">
        <h2 className="text-lg font-semibold text-white truncate">
          {projectName}
        </h2>
      </div>
      
      {/* Navigation */}
      <nav className="flex-1 space-y-1 px-3 py-4">
        {navigation.map((item) => {
          const isActive = item.exact 
            ? pathname === item.href
            : pathname.startsWith(item.href)
          
          return (
            <div key={item.name}>
              <Link
                href={item.href}
                className={`
                  flex items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium transition-colors
                  ${isActive 
                    ? 'bg-slate-800 text-white' 
                    : 'text-slate-300 hover:bg-slate-800 hover:text-white'
                  }
                `}
              >
                <item.icon className="h-5 w-5" />
                {item.name}
              </Link>
              
              {/* Sub-items */}
              {item.children && (
                <div className="ml-8 mt-1 space-y-1">
                  {item.children.map((child) => {
                    const childActive = pathname === child.href
                    return (
                      <Link
                        key={child.name}
                        href={child.href}
                        className={`
                          block rounded-lg px-3 py-1.5 text-sm transition-colors
                          ${childActive
                            ? 'text-white'
                            : 'text-slate-400 hover:text-white'
                          }
                        `}
                      >
                        {child.name}
                      </Link>
                    )
                  })}
                </div>
              )}
            </div>
          )
        })}
      </nav>
    </aside>
  )
}
5. Crear Header
File: components/layout/dashboard-header.tsx
typescript
'use client'

import { useTranslations } from 'next-intl'
import { UserMenu } from './user-menu'
import { Bell } from 'lucide-react'

interface DashboardHeaderProps {
  user: { name?: string | null; email?: string | null }
  orgName: string
}

export function DashboardHeader({ user, orgName }: DashboardHeaderProps) {
  const t = useTranslations('common')
  
  return (
    <header className="flex h-16 items-center justify-between border-b bg-white px-6">
      <div>
        <p className="text-sm text-slate-500">{orgName}</p>
      </div>
      
      <div className="flex items-center gap-4">
        {/* Notifications */}
        <button className="relative rounded-lg p-2 hover:bg-slate-100">
          <Bell className="h-5 w-5 text-slate-600" />
          <span className="absolute right-1 top-1 h-2 w-2 rounded-full bg-red-500" />
        </button>
        
        {/* User menu */}
        <UserMenu user={user} />
      </div>
    </header>
  )
}
6. Crear User Menu
File: components/layout/user-menu.tsx
typescript
'use client'

import { useTranslations } from 'next-intl'
import { signOut } from 'next-auth/react'
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu'
import { User, Settings, LogOut } from 'lucide-react'

interface UserMenuProps {
  user: { name?: string | null; email?: string | null }
}

export function UserMenu({ user }: UserMenuProps) {
  const t = useTranslations('nav')
  
  return (
    <DropdownMenu>
      <DropdownMenuTrigger className="flex items-center gap-2 rounded-lg px-3 py-2 hover:bg-slate-100">
        <div className="flex h-8 w-8 items-center justify-center rounded-full bg-slate-200">
          <User className="h-4 w-4 text-slate-600" />
        </div>
        <span className="text-sm font-medium text-slate-700">
          {user.name || user.email}
        </span>
      </DropdownMenuTrigger>
      
      <DropdownMenuContent align="end" className="w-56">
        <DropdownMenuLabel>
          <div className="flex flex-col">
            <span className="text-sm font-medium">{user.name}</span>
            <span className="text-xs text-slate-500">{user.email}</span>
          </div>
        </DropdownMenuLabel>
        
        <DropdownMenuSeparator />
        
        <DropdownMenuItem asChild>
          <a href="/settings/profile" className="flex items-center gap-2">
            <Settings className="h-4 w-4" />
            {t('settings')}
          </a>
        </DropdownMenuItem>
        
        <DropdownMenuSeparator />
        
        <DropdownMenuItem
          onClick={() => signOut({ callbackUrl: '/login' })}
          className="flex items-center gap-2 text-red-600"
        >
          <LogOut className="h-4 w-4" />
          {t('logout')}
        </DropdownMenuItem>
      </DropdownMenuContent>
    </DropdownMenu>
  )
}
7. Crear Breadcrumbs DinÃ¡micos
File: components/layout/dynamic-breadcrumbs.tsx
typescript
'use client'

import { usePathname } from 'next/navigation'
import { useTranslations } from 'next-intl'
import { Link } from '@/i18n/navigation'
import { ChevronRight, Home } from 'lucide-react'

export function DynamicBreadcrumbs() {
  const pathname = usePathname()
  const t = useTranslations('nav')
  
  // Remove locale from path
  const pathWithoutLocale = pathname.replace(/^\/[a-z]{2}/, '')
  const segments = pathWithoutLocale.split('/').filter(Boolean)
  
  if (segments.length === 0) return null
  
  const breadcrumbs = segments.map((segment, index) => {
    const href = '/' + segments.slice(0, index + 1).join('/')
    
    // Translate known segments
    let label = segment
    if (segment === 'dashboard') label = t('dashboard')
    else if (segment === 'projects') label = t('projects')
    else if (segment === 'budget') label = t('budget')
    else if (segment === 'finance') label = t('finance')
    else if (segment === 'certifications') label = t('certifications')
    else if (segment === 'quality') label = t('quality')
    // Add more translations as needed
    
    return { label, href }
  })
  
  return (
    <nav className="flex items-center space-x-1 text-sm text-slate-600">
      <Link href="/dashboard" className="hover:text-slate-900">
        <Home className="h-4 w-4" />
      </Link>
      
      {breadcrumbs.map((crumb, i) => (
        <div key={i} className="flex items-center">
          <ChevronRight className="h-4 w-4 text-slate-400" />
          {i === breadcrumbs.length - 1 ? (
            <span className="font-medium text-slate-900">{crumb.label}</span>
          ) : (
            <Link href={crumb.href} className="hover:text-slate-900">
              {crumb.label}
            </Link>
          )}
        </div>
      ))}
    </nav>
  )
}
8. Actualizar traducciones
File: messages/es.json
Agregar en la secciÃ³n nav:
json
{
  "nav": {
    "dashboard": "Tablero",
    "projects": "Proyectos",
    "team": "Equipo",
    "inventory": "Inventario",
    "suppliers": "Proveedores",
    "documents": "Documentos",
    "settings": "ConfiguraciÃ³n",
    "projectDashboard": "Dashboard del Proyecto",
    "budget": "Presupuesto",
    "schedule": "Cronograma",
    "finance": "Finanzas",
    "transactions": "Transacciones",
    "certifications": "Certificaciones",
    "quality": "Calidad",
    "rfis": "RFIs",
    "submittals": "Submittals",
    "dailyReports": "Partes Diarios",
    "backToProjects": "Volver a Proyectos",
    "logout": "Cerrar SesiÃ³n"
  }
}
9. Crear API endpoint para proyecto (opcional)
File: app/api/projects/[id]/route.ts
typescript
import { NextRequest, NextResponse } from 'next/server'
import { getSession } from '@/lib/session'
import { getOrgContext } from '@/lib/org-context'
import { prisma } from '@repo/database'

export async function GET(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  const session = await getSession()
  if (!session?.user?.id) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
  }
  
  const { orgId } = await getOrgContext(session.user.id)
  
  const project = await prisma.project.findFirst({
    where: { id: params.id, orgId },
    select: { id: true, name: true, projectNumber: true },
  })
  
  if (!project) {
    return NextResponse.json({ error: 'Not found' }, { status: 404 })
  }
  
  return NextResponse.json(project)
}
Acceptance Criteria:
â€¢	âœ“ Sidebar cambia automÃ¡ticamente entre Global y Proyecto
â€¢	âœ“ NavegaciÃ³n funciona correctamente
â€¢	âœ“ Items activos se destacan
â€¢	âœ“ Breadcrumbs se generan dinÃ¡micamente
â€¢	âœ“ User menu funciona (logout, settings)
â€¢	âœ“ Header muestra org name
â€¢	âœ“ Todo en espaÃ±ol
â€¢	âœ“ Responsive (mobile menu en sidebar)
Testing:
1.	Navegar a /dashboard â†’ Sidebar global
2.	Entrar a un proyecto â†’ Sidebar cambia a proyecto
3.	Click en "Volver a Proyectos" â†’ Vuelve a sidebar global
4.	Verificar breadcrumbs en diferentes rutas
5.	Click en user menu â†’ Logout funciona
â€ƒ
â€ƒ
PROMPT 20: Dashboard Global con KPIs y GrÃ¡ficos
Goal: Crear dashboard global de la organizaciÃ³n con KPIs, grÃ¡ficos de cashflow, alertas y actividad reciente.
Context:
El dashboard global es la primera pantalla que ve el usuario al entrar al sistema. Debe mostrar informaciÃ³n resumida de toda la organizaciÃ³n: proyectos activos, presupuestos, certificaciones, alertas importantes y actividad reciente.
IMPORTANTE - NO MODIFICAR:
â€¢	âŒ No tocar lÃ³gica de backend existente
â€¢	âŒ No modificar server actions ya creados
â€¢	âœ… Usar datos reales desde Prisma
â€¢	âœ… Usar traducciones desde messages/es.json
â€¢	âœ… Usar shadcn/ui components
â€¢	âœ… Usar Recharts para grÃ¡ficos
Requisitos:
1. PÃ¡gina Principal del Dashboard
File: app/[locale]/(dashboard)/dashboard/page.tsx
typescript
import { getSession } from '@/lib/session'
import { getOrgContext } from '@/lib/org-context'
import { redirect } from 'next/navigation'
import { getOrgKPIs, getCashflowData, getAlerts, getRecentActivity } from '@/app/actions/dashboard'
import { KPICards } from '@/components/dashboard/kpi-cards'
import { CashflowChart } from '@/components/dashboard/cashflow-chart'
import { AlertsWidget } from '@/components/dashboard/alerts-widget'
import { RecentActivityFeed } from '@/components/dashboard/recent-activity-feed'
import { getTranslations } from 'next-intl/server'

export default async function DashboardPage({
  params,
}: {
  params: { locale: string }
}) {
  const session = await getSession()
  if (!session?.user?.id) redirect(`/${params.locale}/login`)
  
  const orgContext = await getOrgContext(session.user.id)
  if (!orgContext) redirect(`/${params.locale}/login`)
  
  const t = await getTranslations('dashboard')
  
  // Fetch dashboard data
  const [kpis, cashflowData, alerts, recentActivity] = await Promise.all([
    getOrgKPIs(orgContext.orgId),
    getCashflowData(orgContext.orgId),
    getAlerts(orgContext.orgId),
    getRecentActivity(orgContext.orgId),
  ])
  
  return (
    <div className="space-y-6 p-6">
      {/* Page header */}
      <div>
        <h1 className="text-2xl font-semibold text-slate-900">
          {t('title')}
        </h1>
        <p className="mt-1 text-sm text-slate-500">
          {t('subtitle')}
        </p>
      </div>
      
      {/* KPI Cards */}
      <KPICards kpis={kpis} />
      
      {/* Main content grid */}
      <div className="grid grid-cols-1 gap-6 lg:grid-cols-3">
        {/* Cashflow chart - takes 2 columns */}
        <div className="lg:col-span-2">
          <CashflowChart data={cashflowData} />
        </div>
        
        {/* Alerts widget */}
        <div>
          <AlertsWidget alerts={alerts} />
        </div>
      </div>
      
      {/* Recent activity */}
      <RecentActivityFeed activities={recentActivity} />
    </div>
  )
}
2. Server Actions para Dashboard
File: app/actions/dashboard.ts (NUEVO)
typescript
'use server'

import { prisma } from '@repo/database'
import { Decimal } from '@prisma/client/runtime/library'

export async function getOrgKPIs(orgId: string) {
  // Total proyectos activos
  const activeProjectsCount = await prisma.project.count({
    where: { orgId, status: 'ACTIVE', active: true },
  })
  
  // Presupuesto total en curso (suma de BASELINE versions)
  const budgetTotal = await prisma.budgetVersion.aggregate({
    where: {
      orgId,
      versionType: 'BASELINE',
      project: { status: 'ACTIVE', active: true },
    },
    _sum: {
      // Necesitamos sumar el total de cada versiÃ³n
      // Como no hay campo directo, calculamos desde lines
    },
  })
  
  // Alternativa: calcular desde budget lines
  const budgetLines = await prisma.budgetLine.findMany({
    where: {
      orgId,
      budgetVersion: {
        versionType: 'BASELINE',
        project: { status: 'ACTIVE', active: true },
      },
    },
    select: { directCostTotal: true },
  })
  
  const totalBudget = budgetLines.reduce(
    (sum, line) => sum.add(line.directCostTotal),
    new Decimal(0)
  )
  
  // Certificaciones pendientes de aprobaciÃ³n
  const pendingCertifications = await prisma.certification.count({
    where: { orgId, status: 'ISSUED' },
  })
  
  // Gastos del mes actual
  const now = new Date()
  const firstDayOfMonth = new Date(now.getFullYear(), now.getMonth(), 1)
  
  const monthExpenses = await prisma.financeTransaction.aggregate({
    where: {
      orgId,
      type: { in: ['PAYMENT_MADE', 'EXPENSE'] },
      status: { in: ['APPROVED', 'PAID'] },
      issueDate: { gte: firstDayOfMonth },
    },
    _sum: { amountBaseCurrency: true },
  })
  
  return {
    activeProjects: activeProjectsCount,
    totalBudget: Number(totalBudget),
    pendingCertifications,
    monthExpenses: Number(monthExpenses._sum.amountBaseCurrency || 0),
  }
}

export async function getCashflowData(orgId: string) {
  // Ãšltimos 6 meses de cashflow
  const sixMonthsAgo = new Date()
  sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6)
  
  // Ingresos (certificaciones aprobadas)
  const income = await prisma.certification.findMany({
    where: {
      orgId,
      status: 'APPROVED',
      approvedAt: { gte: sixMonthsAgo },
    },
    include: {
      lines: {
        select: { periodAmount: true },
      },
    },
    orderBy: { periodYear: 'asc' },
  })
  
  // Gastos (transacciones pagadas)
  const expenses = await prisma.financeTransaction.findMany({
    where: {
      orgId,
      type: { in: ['PAYMENT_MADE', 'EXPENSE'] },
      status: { in: ['APPROVED', 'PAID'] },
      issueDate: { gte: sixMonthsAgo },
    },
    select: {
      issueDate: true,
      amountBaseCurrency: true,
    },
    orderBy: { issueDate: 'asc' },
  })
  
  // Agrupar por mes
  const monthlyData = new Map<string, { income: number; expenses: number }>()
  
  // Procesar certificaciones
  income.forEach((cert) => {
    const monthKey = `${cert.periodYear}-${String(cert.periodMonth).padStart(2, '0')}`
    const total = cert.lines.reduce(
      (sum, line) => sum.add(line.periodAmount),
      new Decimal(0)
    )
    
    if (!monthlyData.has(monthKey)) {
      monthlyData.set(monthKey, { income: 0, expenses: 0 })
    }
    monthlyData.get(monthKey)!.income += Number(total)
  })
  
  // Procesar gastos
  expenses.forEach((expense) => {
    const date = new Date(expense.issueDate)
    const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`
    
    if (!monthlyData.has(monthKey)) {
      monthlyData.set(monthKey, { income: 0, expenses: 0 })
    }
    monthlyData.get(monthKey)!.expenses += Number(expense.amountBaseCurrency)
  })
  
  // Convertir a array ordenado
  return Array.from(monthlyData.entries())
    .sort((a, b) => a[0].localeCompare(b[0]))
    .map(([month, data]) => ({
      month,
      income: data.income,
      expenses: data.expenses,
      net: data.income - data.expenses,
    }))
}

export async function getAlerts(orgId: string) {
  const alerts: Array<{
    id: string
    type: 'warning' | 'error' | 'info'
    title: string
    message: string
    link?: string
  }> = []
  
  // 1. Presupuestos cerca del lÃ­mite (>90% gastado)
  const budgetLines = await prisma.budgetLine.findMany({
    where: {
      orgId,
      budgetVersion: {
        versionType: 'BASELINE',
        project: { status: 'ACTIVE' },
      },
    },
    include: {
      budgetVersion: {
        include: { project: true },
      },
      wbsNode: true,
    },
  })
  
  // Calcular actual cost desde finance lines
  for (const line of budgetLines) {
    const actualCost = await prisma.financeLine.aggregate({
      where: {
        wbsNodeId: line.wbsNodeId,
        transaction: {
          status: { in: ['APPROVED', 'PAID'] },
          deleted: false,
        },
      },
      _sum: { lineTotal: true },
    })
    
    const actual = Number(actualCost._sum.lineTotal || 0)
    const planned = Number(line.directCostTotal)
    const percentage = planned > 0 ? (actual / planned) * 100 : 0
    
    if (percentage > 90) {
      alerts.push({
        id: `budget-${line.id}`,
        type: 'warning',
        title: 'Presupuesto cerca del lÃ­mite',
        message: `${line.wbsNode.name} estÃ¡ al ${percentage.toFixed(0)}% del presupuesto`,
        link: `/projects/${line.budgetVersion.projectId}/budget`,
      })
    }
  }
  
  // 2. Certificaciones vencidas (>30 dÃ­as sin aprobar)
  const thirtyDaysAgo = new Date()
  thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30)
  
  const overdueRubricated = await prisma.certification.findMany({
    where: {
      orgId,
      status: 'ISSUED',
      issuedAt: { lt: thirtyDaysAgo },
    },
    include: { project: true },
  })
  
  overdueRubricated.forEach((cert) => {
    alerts.push({
      id: `cert-${cert.id}`,
      type: 'error',
      title: 'CertificaciÃ³n pendiente',
      message: `CertificaciÃ³n ${cert.number} de ${cert.project.name} sin aprobar hace mÃ¡s de 30 dÃ­as`,
      link: `/projects/${cert.projectId}/certifications/${cert.id}`,
    })
  })
  
  // 3. RFIs sin responder (>7 dÃ­as)
  const sevenDaysAgo = new Date()
  sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7)
  
  const unansweredRFIs = await prisma.rFI.count({
    where: {
      orgId,
      status: 'OPEN',
      createdAt: { lt: sevenDaysAgo },
    },
  })
  
  if (unansweredRFIs > 0) {
    alerts.push({
      id: 'rfis-overdue',
      type: 'warning',
      title: 'RFIs sin responder',
      message: `${unansweredRFIs} RFI(s) abiertos hace mÃ¡s de 7 dÃ­as`,
      link: '/quality/rfis',
    })
  }
  
  // 4. Inventario bajo stock mÃ­nimo
  const lowStockItems = await prisma.inventoryItem.findMany({
    where: {
      orgId,
      active: true,
      minStockQty: { not: null },
    },
    select: {
      id: true,
      name: true,
      minStockQty: true,
    },
  })
  
  for (const item of lowStockItems) {
    // Calcular stock actual desde movements
    const movements = await prisma.inventoryMovement.findMany({
      where: { itemId: item.id },
      select: {
        movementType: true,
        quantity: true,
        toLocationId: true,
        fromLocationId: true,
      },
    })
    
    let currentStock = new Decimal(0)
    movements.forEach((mov) => {
      if (mov.movementType === 'PURCHASE' || mov.movementType === 'ADJUSTMENT') {
        currentStock = currentStock.add(mov.quantity)
      } else if (mov.movementType === 'ISSUE') {
        currentStock = currentStock.sub(mov.quantity)
      }
    })
    
    if (item.minStockQty && currentStock.lessThan(item.minStockQty)) {
      alerts.push({
        id: `inventory-${item.id}`,
        type: 'warning',
        title: 'Stock bajo',
        message: `${item.name} estÃ¡ por debajo del stock mÃ­nimo`,
        link: '/inventory',
      })
    }
  }
  
  return alerts.slice(0, 5) // MÃ¡ximo 5 alertas
}

export async function getRecentActivity(orgId: string) {
  // Ãšltimas 10 actividades del audit log
  const activities = await prisma.auditLog.findMany({
    where: { orgId },
    orderBy: { createdAt: 'desc' },
    take: 10,
    include: {
      actorUser: {
        select: { fullName: true },
      },
      project: {
        select: { name: true },
      },
    },
  })
  
  return activities.map((activity) => ({
    id: activity.id,
    action: activity.action,
    entityType: activity.entityType,
    actorName: activity.actorUser?.fullName || 'Sistema',
    projectName: activity.project?.name,
    createdAt: activity.createdAt,
    details: activity.detailsJson,
  }))
}
3. Componente KPI Cards
File: components/dashboard/kpi-cards.tsx
typescript
'use client'

import { useTranslations } from 'next-intl'
import { formatCurrency } from '@/lib/format-utils'
import { FolderKanban, DollarSign, FileCheck, TrendingDown } from 'lucide-react'

interface KPICardsProps {
  kpis: {
    activeProjects: number
    totalBudget: number
    pendingCertifications: number
    monthExpenses: number
  }
}

export function KPICards({ kpis }: KPICardsProps) {
  const t = useTranslations('dashboard')
  
  const cards = [
    {
      title: t('kpiActiveProjects'),
      value: kpis.activeProjects,
      icon: FolderKanban,
      color: 'bg-blue-500',
      format: 'number',
    },
    {
      title: t('kpiTotalBudget'),
      value: kpis.totalBudget,
      icon: DollarSign,
      color: 'bg-green-500',
      format: 'currency',
    },
    {
      title: t('kpiPendingCertifications'),
      value: kpis.pendingCertifications,
      icon: FileCheck,
      color: 'bg-orange-500',
      format: 'number',
    },
    {
      title: t('kpiMonthExpenses'),
      value: kpis.monthExpenses,
      icon: TrendingDown,
      color: 'bg-red-500',
      format: 'currency',
    },
  ]
  
  return (
    <div className="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4">
      {cards.map((card) => (
        <div
          key={card.title}
          className="rounded-lg border border-slate-200 bg-white p-6 shadow-sm"
        >
          <div className="flex items-center justify-between">
            <div className="flex-1">
              <p className="text-sm font-medium text-slate-600">
                {card.title}
              </p>
              <p className="mt-2 text-3xl font-semibold text-slate-900">
                {card.format === 'currency'
                  ? formatCurrency(card.value)
                  : card.value}
              </p>
            </div>
            <div className={`${card.color} rounded-lg p-3`}>
              <card.icon className="h-6 w-6 text-white" />
            </div>
          </div>
        </div>
      ))}
    </div>
  )
}
4. Componente Cashflow Chart
File: components/dashboard/cashflow-chart.tsx
typescript
'use client'

import { useTranslations } from 'next-intl'
import { formatCurrency } from '@/lib/format-utils'
import {
  LineChart,
  Line,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  Legend,
  ResponsiveContainer,
} from 'recharts'

interface CashflowChartProps {
  data: Array<{
    month: string
    income: number
    expenses: number
    net: number
  }>
}

export function CashflowChart({ data }: CashflowChartProps) {
  const t = useTranslations('dashboard')
  
  // Formatear mes para display
  const formattedData = data.map((item) => {
    const [year, month] = item.month.split('-')
    const monthNames = [
      'Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun',
      'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'
    ]
    
    return {
      ...item,
      monthLabel: `${monthNames[parseInt(month) - 1]} ${year}`,
    }
  })
  
  return (
    <div className="rounded-lg border border-slate-200 bg-white p-6 shadow-sm">
      <h3 className="text-lg font-semibold text-slate-900">
        {t('cashflowTitle')}
      </h3>
      <p className="mt-1 text-sm text-slate-500">
        {t('cashflowSubtitle')}
      </p>
      
      <div className="mt-6 h-80">
        <ResponsiveContainer width="100%" height="100%">
          <LineChart data={formattedData}>
            <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
            <XAxis 
              dataKey="monthLabel" 
              stroke="#64748b"
              fontSize={12}
            />
            <YAxis 
              stroke="#64748b"
              fontSize={12}
              tickFormatter={(value) => formatCurrency(value, 'es-AR', 'ARS', true)}
            />
            <Tooltip
              contentStyle={{
                backgroundColor: '#fff',
                border: '1px solid #e2e8f0',
                borderRadius: '8px',
              }}
              formatter={(value: number) => formatCurrency(value)}
            />
            <Legend />
            <Line
              type="monotone"
              dataKey="income"
              name={t('income')}
              stroke="#10b981"
              strokeWidth={2}
              dot={{ fill: '#10b981' }}
            />
            <Line
              type="monotone"
              dataKey="expenses"
              name={t('expenses')}
              stroke="#ef4444"
              strokeWidth={2}
              dot={{ fill: '#ef4444' }}
            />
            <Line
              type="monotone"
              dataKey="net"
              name={t('net')}
              stroke="#3b82f6"
              strokeWidth={2}
              dot={{ fill: '#3b82f6' }}
            />
          </LineChart>
        </ResponsiveContainer>
      </div>
    </div>
  )
}
5. Componente Alerts Widget
File: components/dashboard/alerts-widget.tsx
typescript
'use client'

import { useTranslations } from 'next-intl'
import { Link } from '@/i18n/navigation'
import { AlertTriangle, XCircle, Info } from 'lucide-react'

interface Alert {
  id: string
  type: 'warning' | 'error' | 'info'
  title: string
  message: string
  link?: string
}

interface AlertsWidgetProps {
  alerts: Alert[]
}

export function AlertsWidget({ alerts }: AlertsWidgetProps) {
  const t = useTranslations('dashboard')
  
  const iconMap = {
    warning: AlertTriangle,
    error: XCircle,
    info: Info,
  }
  
  const colorMap = {
    warning: 'text-orange-600 bg-orange-50',
    error: 'text-red-600 bg-red-50',
    info: 'text-blue-600 bg-blue-50',
  }
  
  return (
    <div className="rounded-lg border border-slate-200 bg-white p-6 shadow-sm">
      <h3 className="text-lg font-semibold text-slate-900">
        {t('alertsTitle')}
      </h3>
      
      {alerts.length === 0 ? (
        <p className="mt-4 text-sm text-slate-500">
          {t('noAlerts')}
        </p>
      ) : (
        <div className="mt-4 space-y-3">
          {alerts.map((alert) => {
            const Icon = iconMap[alert.type]
            const colorClass = colorMap[alert.type]
            
            const content = (
              <div className="flex gap-3">
                <div className={`rounded-lg p-2 ${colorClass}`}>
                  <Icon className="h-5 w-5" />
                </div>
                <div className="flex-1 min-w-0">
                  <p className="text-sm font-medium text-slate-900">
                    {alert.title}
                  </p>
                  <p className="mt-1 text-sm text-slate-600 truncate">
                    {alert.message}
                  </p>
                </div>
              </div>
            )
            
            if (alert.link) {
              return (
                <Link
                  key={alert.id}
                  href={alert.link}
                  className="block rounded-lg border border-slate-200 p-4 transition-colors hover:bg-slate-50"
                >
                  {content}
                </Link>
              )
            }
            
            return (
              <div
                key={alert.id}
                className="rounded-lg border border-slate-200 p-4"
              >
                {content}
              </div>
            )
          })}
        </div>
      )}
    </div>
  )
}
6. Componente Recent Activity Feed
File: components/dashboard/recent-activity-feed.tsx
typescript
'use client'

import { useTranslations } from 'next-intl'
import { formatDistanceToNow } from 'date-fns'
import { es } from 'date-fns/locale'

interface Activity {
  id: string
  action: string
  entityType: string
  actorName: string
  projectName?: string | null
  createdAt: Date
}

interface RecentActivityFeedProps {
  activities: Activity[]
}

export function RecentActivityFeed({ activities }: RecentActivityFeedProps) {
  const t = useTranslations('dashboard')
  
  const getActionLabel = (action: string, entityType: string) => {
    const key = `activity_${action}_${entityType}`.toLowerCase()
    return t(key, { defaultValue: `${action} ${entityType}` })
  }
  
  return (
    <div className="rounded-lg border border-slate-200 bg-white p-6 shadow-sm">
      <h3 className="text-lg font-semibold text-slate-900">
        {t('recentActivityTitle')}
      </h3>
      
      {activities.length === 0 ? (
        <p className="mt-4 text-sm text-slate-500">
          {t('noRecentActivity')}
        </p>
      ) : (
        <div className="mt-4 space-y-4">
          {activities.map((activity) => (
            <div
              key={activity.id}
              className="flex items-start gap-4 border-b border-slate-100 pb-4 last:border-0 last:pb-0"
            >
              <div className="flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full bg-slate-100">
                <span className="text-sm font-medium text-slate-600">
                  {activity.actorName.charAt(0).toUpperCase()}
                </span>
              </div>
              
              <div className="flex-1 min-w-0">
                <p className="text-sm text-slate-900">
                  <span className="font-medium">{activity.actorName}</span>
                  {' '}
                  {getActionLabel(activity.action, activity.entityType)}
                  {activity.projectName && (
                    <>
                      {' '}en{' '}
                      <span className="font-medium">{activity.projectName}</span>
                    </>
                  )}
                </p>
                <p className="mt-1 text-xs text-slate-500">
                  {formatDistanceToNow(new Date(activity.createdAt), {
                    addSuffix: true,
                    locale: es,
                  })}
                </p>
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  )
}
7. Actualizar format-utils para compact currency
File: lib/format-utils.ts
Agregar parÃ¡metro opcional para formato compacto:
typescript
export function formatCurrency(
  amount: number,
  locale = 'es-AR',
  currency = 'ARS',
  compact = false
) {
  if (compact && Math.abs(amount) >= 1000) {
    // Formato compacto para grÃ¡ficos
    const formatter = new Intl.NumberFormat(locale, {
      notation: 'compact',
      compactDisplay: 'short',
      maximumFractionDigits: 1,
    })
    return formatter.format(amount)
  }
  
  return new Intl.NumberFormat(locale, {
    style: 'currency',
    currency,
    minimumFractionDigits: 0,
    maximumFractionDigits: 0,
  }).format(amount)
}
8. Actualizar traducciones
File: messages/es.json
Agregar secciÃ³n de dashboard:
json
{
  "dashboard": {
    "title": "Tablero de Control",
    "subtitle": "Resumen de la actividad de tu organizaciÃ³n",
    "kpiActiveProjects": "Proyectos Activos",
    "kpiTotalBudget": "Presupuesto Total",
    "kpiPendingCertifications": "Certificaciones Pendientes",
    "kpiMonthExpenses": "Gastos del Mes",
    "cashflowTitle": "Flujo de Caja",
    "cashflowSubtitle": "Ingresos y gastos de los Ãºltimos 6 meses",
    "income": "Ingresos",
    "expenses": "Gastos",
    "net": "Neto",
    "alertsTitle": "Alertas",
    "noAlerts": "No hay alertas por el momento",
    "recentActivityTitle": "Actividad Reciente",
    "noRecentActivity": "No hay actividad reciente",
    "activity_create_project": "creÃ³ el proyecto",
    "activity_update_project": "actualizÃ³ el proyecto",
    "activity_create_budgetversion": "creÃ³ una versiÃ³n de presupuesto en",
    "activity_approve_budgetversion": "aprobÃ³ el presupuesto de",
    "activity_create_certification": "creÃ³ una certificaciÃ³n en",
    "activity_approve_certification": "aprobÃ³ una certificaciÃ³n en",
    "activity_create_changeorder": "creÃ³ una orden de cambio en",
    "activity_approve_changeorder": "aprobÃ³ una orden de cambio en"
  }
}
9. Instalar dependencias necesarias
bash
# En apps/web
pnpm add recharts date-fns
pnpm add -D @types/recharts
Acceptance Criteria:
â€¢	âœ“ Dashboard muestra KPIs reales desde base de datos
â€¢	âœ“ GrÃ¡fico de cashflow renderiza correctamente con Recharts
â€¢	âœ“ Alertas se generan automÃ¡ticamente segÃºn reglas de negocio
â€¢	âœ“ Feed de actividad muestra Ãºltimas acciones
â€¢	âœ“ Todo en espaÃ±ol con formato ARS
â€¢	âœ“ Responsive en mobile
â€¢	âœ“ Performance: datos cargados en paralelo con Promise.all
Testing:
1.	Navegar a /dashboard
2.	Verificar que KPIs muestran nÃºmeros correctos
3.	Verificar grÃ¡fico de cashflow (debe tener datos de al menos 1 mes)
4.	Crear alertas artificiales (presupuesto >90%, RFI viejo)
5.	Verificar que alertas aparecen
6.	Hacer alguna acciÃ³n (crear proyecto) y verificar en actividad reciente
â€ƒ
â€ƒ
â€ƒ
PROMPT 21: Lista de Proyectos con Tabla Avanzada
Goal: Crear lista de proyectos con tabla filtrable, sorting, bÃºsqueda y vistas alternativas (tabla/grid).
Context:
La lista de proyectos es el punto de entrada principal para acceder a proyectos individuales. Debe permitir filtrado por estado, fase, bÃºsqueda por nombre/nÃºmero, y toggle entre vista tabla y vista grid de cards.
IMPORTANTE - NO MODIFICAR:
â€¢	âŒ No tocar server actions existentes en app/actions/projects.ts
â€¢	âŒ No modificar lÃ³gica de backend
â€¢	âœ… Usar TanStack Table para tabla avanzada
â€¢	âœ… Usar traducciones desde messages/es.json
â€¢	âœ… Usar shadcn/ui components
â€¢	âœ… Colores en formato HSL (no hex)
Requisitos:
1. PÃ¡gina de Lista de Proyectos
File: app/[locale]/(dashboard)/projects/page.tsx
typescript
import { getSession } from '@/lib/session'
import { getOrgContext } from '@/lib/org-context'
import { redirect } from 'next/navigation'
import { listProjects } from '@/app/actions/projects'
import { ProjectsListClient } from '@/components/projects/projects-list-client'
import { getTranslations } from 'next-intl/server'
import { Link } from '@/i18n/navigation'
import { Button } from '@/components/ui/button'
import { Plus } from 'lucide-react'

export default async function ProjectsPage({
  params,
  searchParams,
}: {
  params: { locale: string }
  searchParams: { 
    status?: string
    phase?: string
    search?: string
  }
}) {
  const session = await getSession()
  if (!session?.user?.id) redirect(`/${params.locale}/login`)
  
  const orgContext = await getOrgContext(session.user.id)
  if (!orgContext) redirect(`/${params.locale}/login`)
  
  const t = await getTranslations('projects')
  
  // Fetch projects with filters
  const projects = await listProjects(orgContext.orgId, {
    status: searchParams.status,
    phase: searchParams.phase,
    search: searchParams.search,
  })
  
  return (
    <div className="space-y-6 p-6">
      {/* Page header */}
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-semibold text-slate-900">
            {t('title')}
          </h1>
          <p className="mt-1 text-sm text-slate-500">
            {t('subtitle')}
          </p>
        </div>
        
        {/* New project button - only for EDITOR and above */}
        {['EDITOR', 'ADMIN', 'OWNER'].includes(orgContext.role) && (
          <Button asChild>
            <Link href="/projects/new">
              <Plus className="mr-2 h-4 w-4" />
              {t('newProject')}
            </Link>
          </Button>
        )}
      </div>
      
      {/* Projects list/grid */}
      <ProjectsListClient 
        projects={projects} 
        canEdit={['EDITOR', 'ADMIN', 'OWNER'].includes(orgContext.role)}
      />
    </div>
  )
}
2. Client Component con Tabla y Filtros
File: components/projects/projects-list-client.tsx
typescript
'use client'

import { useState, useMemo } from 'react'
import { useTranslations } from 'next-intl'
import { useRouter, usePathname, useSearchParams } from 'next/navigation'
import {
  flexRender,
  getCoreRowModel,
  getSortedRowModel,
  getFilteredRowModel,
  useReactTable,
  type ColumnDef,
  type SortingState,
  type ColumnFiltersState,
} from '@tanstack/react-table'
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table'
import { Input } from '@/components/ui/input'
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select'
import { Button } from '@/components/ui/button'
import { ProjectCard } from './project-card'
import { ProjectStatusBadge } from './project-status-badge'
import { ProjectPhaseBadge } from './project-phase-badge'
import { formatCurrency } from '@/lib/format-utils'
import { ArrowUpDown, Grid, List, Eye } from 'lucide-react'
import { Link } from '@/i18n/navigation'

interface Project {
  id: string
  projectNumber: string
  name: string
  clientName: string | null
  phase: string
  status: string
  totalBudget: number
  createdAt: Date
}

interface ProjectsListClientProps {
  projects: Project[]
  canEdit: boolean
}

export function ProjectsListClient({ projects, canEdit }: ProjectsListClientProps) {
  const t = useTranslations('projects')
  const router = useRouter()
  const pathname = usePathname()
  const searchParams = useSearchParams()
  
  const [sorting, setSorting] = useState<SortingState>([])
  const [columnFilters, setColumnFilters] = useState<ColumnFiltersState>([])
  const [viewMode, setViewMode] = useState<'table' | 'grid'>('table')
  
  // Search and filter states
  const [search, setSearch] = useState(searchParams.get('search') || '')
  const [statusFilter, setStatusFilter] = useState(searchParams.get('status') || 'all')
  const [phaseFilter, setPhaseFilter] = useState(searchParams.get('phase') || 'all')
  
  // Update URL when filters change
  const updateFilters = (newSearch: string, newStatus: string, newPhase: string) => {
    const params = new URLSearchParams()
    if (newSearch) params.set('search', newSearch)
    if (newStatus !== 'all') params.set('status', newStatus)
    if (newPhase !== 'all') params.set('phase', newPhase)
    
    const queryString = params.toString()
    router.push(`${pathname}${queryString ? '?' + queryString : ''}`)
  }
  
  // Columns definition
  const columns = useMemo<ColumnDef<Project>[]>(
    () => [
      {
        accessorKey: 'projectNumber',
        header: ({ column }) => {
          return (
            <Button
              variant="ghost"
              onClick={() => column.toggleSorting(column.getIsSorted() === 'asc')}
              className="h-8 px-2"
            >
              {t('projectNumber')}
              <ArrowUpDown className="ml-2 h-4 w-4" />
            </Button>
          )
        },
        cell: ({ row }) => (
          <span className="font-mono text-xs font-medium">
            {row.getValue('projectNumber')}
          </span>
        ),
      },
      {
        accessorKey: 'name',
        header: ({ column }) => {
          return (
            <Button
              variant="ghost"
              onClick={() => column.toggleSorting(column.getIsSorted() === 'asc')}
              className="h-8 px-2"
            >
              {t('name')}
              <ArrowUpDown className="ml-2 h-4 w-4" />
            </Button>
          )
        },
        cell: ({ row }) => (
          <span className="font-medium text-slate-900">
            {row.getValue('name')}
          </span>
        ),
      },
      {
        accessorKey: 'clientName',
        header: t('client'),
        cell: ({ row }) => (
          <span className="text-slate-600">
            {row.getValue('clientName') || '-'}
          </span>
        ),
      },
      {
        accessorKey: 'phase',
        header: t('phase'),
        cell: ({ row }) => (
          <ProjectPhaseBadge phase={row.getValue('phase')} />
        ),
      },
      {
        accessorKey: 'status',
        header: t('status'),
        cell: ({ row }) => (
          <ProjectStatusBadge status={row.getValue('status')} />
        ),
      },
      {
        accessorKey: 'totalBudget',
        header: ({ column }) => {
          return (
            <Button
              variant="ghost"
              onClick={() => column.toggleSorting(column.getIsSorted() === 'asc')}
              className="h-8 px-2"
            >
              {t('budget')}
              <ArrowUpDown className="ml-2 h-4 w-4" />
            </Button>
          )
        },
        cell: ({ row }) => (
          <span className="font-medium tabular-nums">
            {formatCurrency(row.getValue('totalBudget'))}
          </span>
        ),
      },
      {
        id: 'actions',
        header: t('actions'),
        cell: ({ row }) => (
          <Button asChild variant="ghost" size="sm">
            <Link href={`/projects/${row.original.id}`}>
              <Eye className="mr-2 h-4 w-4" />
              {t('view')}
            </Link>
          </Button>
        ),
      },
    ],
    [t]
  )
  
  // Filter projects locally
  const filteredProjects = useMemo(() => {
    return projects.filter((project) => {
      // Search filter
      if (search) {
        const searchLower = search.toLowerCase()
        const matchesSearch =
          project.name.toLowerCase().includes(searchLower) ||
          project.projectNumber.toLowerCase().includes(searchLower) ||
          project.clientName?.toLowerCase().includes(searchLower)
        
        if (!matchesSearch) return false
      }
      
      // Status filter
      if (statusFilter !== 'all' && project.status !== statusFilter) {
        return false
      }
      
      // Phase filter
      if (phaseFilter !== 'all' && project.phase !== phaseFilter) {
        return false
      }
      
      return true
    })
  }, [projects, search, statusFilter, phaseFilter])
  
  // Table instance
  const table = useReactTable({
    data: filteredProjects,
    columns,
    getCoreRowModel: getCoreRowModel(),
    getSortedRowModel: getSortedRowModel(),
    getFilteredRowModel: getFilteredRowModel(),
    onSortingChange: setSorting,
    onColumnFiltersChange: setColumnFilters,
    state: {
      sorting,
      columnFilters,
    },
  })
  
  return (
    <div className="space-y-4">
      {/* Filters and view toggle */}
      <div className="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
        {/* Search */}
        <div className="flex-1 sm:max-w-xs">
          <Input
            placeholder={t('searchPlaceholder')}
            value={search}
            onChange={(e) => {
              setSearch(e.target.value)
              updateFilters(e.target.value, statusFilter, phaseFilter)
            }}
            className="h-9"
          />
        </div>
        
        <div className="flex items-center gap-2">
          {/* Status filter */}
          <Select
            value={statusFilter}
            onValueChange={(value) => {
              setStatusFilter(value)
              updateFilters(search, value, phaseFilter)
            }}
          >
            <SelectTrigger className="h-9 w-[140px]">
              <SelectValue />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="all">{t('statusAll')}</SelectItem>
              <SelectItem value="DRAFT">{t('statusDraft')}</SelectItem>
              <SelectItem value="ACTIVE">{t('statusActive')}</SelectItem>
              <SelectItem value="ON_HOLD">{t('statusOnHold')}</SelectItem>
              <SelectItem value="COMPLETE">{t('statusComplete')}</SelectItem>
            </SelectContent>
          </Select>
          
          {/* Phase filter */}
          <Select
            value={phaseFilter}
            onValueChange={(value) => {
              setPhaseFilter(value)
              updateFilters(search, statusFilter, value)
            }}
          >
            <SelectTrigger className="h-9 w-[140px]">
              <SelectValue />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="all">{t('phaseAll')}</SelectItem>
              <SelectItem value="PRE_CONSTRUCTION">{t('phasePreConstruction')}</SelectItem>
              <SelectItem value="CONSTRUCTION">{t('phaseConstruction')}</SelectItem>
              <SelectItem value="CLOSEOUT">{t('phaseCloseout')}</SelectItem>
            </SelectContent>
          </Select>
          
          {/* View mode toggle */}
          <div className="flex items-center gap-1 rounded-lg border border-slate-200 p-1">
            <Button
              variant={viewMode === 'table' ? 'secondary' : 'ghost'}
              size="sm"
              onClick={() => setViewMode('table')}
              className="h-7 px-2"
            >
              <List className="h-4 w-4" />
            </Button>
            <Button
              variant={viewMode === 'grid' ? 'secondary' : 'ghost'}
              size="sm"
              onClick={() => setViewMode('grid')}
              className="h-7 px-2"
            >
              <Grid className="h-4 w-4" />
            </Button>
          </div>
        </div>
      </div>
      
      {/* Results count */}
      <p className="text-sm text-slate-500">
        {t('showing')} {filteredProjects.length} {t('of')} {projects.length} {t('projects')}
      </p>
      
      {/* Table or Grid view */}
      {viewMode === 'table' ? (
        <div className="rounded-lg border border-slate-200 bg-white">
          <Table>
            <TableHeader>
              {table.getHeaderGroups().map((headerGroup) => (
                <TableRow key={headerGroup.id}>
                  {headerGroup.headers.map((header) => (
                    <TableHead key={header.id}>
                      {header.isPlaceholder
                        ? null
                        : flexRender(
                            header.column.columnDef.header,
                            header.getContext()
                          )}
                    </TableHead>
                  ))}
                </TableRow>
              ))}
            </TableHeader>
            <TableBody>
              {table.getRowModel().rows?.length ? (
                table.getRowModel().rows.map((row) => (
                  <TableRow
                    key={row.id}
                    data-state={row.getIsSelected() && 'selected'}
                  >
                    {row.getVisibleCells().map((cell) => (
                      <TableCell key={cell.id}>
                        {flexRender(
                          cell.column.columnDef.cell,
                          cell.getContext()
                        )}
                      </TableCell>
                    ))}
                  </TableRow>
                ))
              ) : (
                <TableRow>
                  <TableCell
                    colSpan={columns.length}
                    className="h-24 text-center"
                  >
                    {t('noResults')}
                  </TableCell>
                </TableRow>
              )}
            </TableBody>
          </Table>
        </div>
      ) : (
        <div className="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3">
          {filteredProjects.length > 0 ? (
            filteredProjects.map((project) => (
              <ProjectCard key={project.id} project={project} />
            ))
          ) : (
            <div className="col-span-full py-12 text-center text-slate-500">
              {t('noResults')}
            </div>
          )}
        </div>
      )}
    </div>
  )
}
3. Componente ProjectCard para Vista Grid
File: components/projects/project-card.tsx
typescript
'use client'

import { useTranslations } from 'next-intl'
import { Link } from '@/i18n/navigation'
import { ProjectStatusBadge } from './project-status-badge'
import { ProjectPhaseBadge } from './project-phase-badge'
import { formatCurrency } from '@/lib/format-utils'
import { Calendar, MapPin, User } from 'lucide-react'

interface ProjectCardProps {
  project: {
    id: string
    projectNumber: string
    name: string
    clientName: string | null
    phase: string
    status: string
    totalBudget: number
    location?: string | null
    startDate?: Date | null
  }
}

export function ProjectCard({ project }: ProjectCardProps) {
  const t = useTranslations('projects')
  
  return (
    <Link
      href={`/projects/${project.id}`}
      className="block rounded-lg border border-slate-200 bg-white p-6 shadow-sm transition-shadow hover:shadow-md"
    >
      {/* Header */}
      <div className="flex items-start justify-between">
        <div className="flex-1 min-w-0">
          <span className="text-xs font-medium text-slate-500">
            {project.projectNumber}
          </span>
          <h3 className="mt-1 truncate text-lg font-semibold text-slate-900">
            {project.name}
          </h3>
        </div>
        <ProjectStatusBadge status={project.status} />
      </div>
      
      {/* Details */}
      <div className="mt-4 space-y-2">
        {project.clientName && (
          <div className="flex items-center gap-2 text-sm text-slate-600">
            <User className="h-4 w-4 flex-shrink-0" />
            <span className="truncate">{project.clientName}</span>
          </div>
        )}
        
        {project.location && (
          <div className="flex items-center gap-2 text-sm text-slate-600">
            <MapPin className="h-4 w-4 flex-shrink-0" />
            <span className="truncate">{project.location}</span>
          </div>
        )}
        
        {project.startDate && (
          <div className="flex items-center gap-2 text-sm text-slate-600">
            <Calendar className="h-4 w-4 flex-shrink-0" />
            <span>
              {new Date(project.startDate).toLocaleDateString('es-AR', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
              })}
            </span>
          </div>
        )}
      </div>
      
      {/* Footer */}
      <div className="mt-4 flex items-center justify-between border-t border-slate-100 pt-4">
        <ProjectPhaseBadge phase={project.phase} />
        <div className="text-right">
          <p className="text-xs text-slate-500">{t('budget')}</p>
          <p className="text-lg font-semibold text-slate-900">
            {formatCurrency(project.totalBudget)}
          </p>
        </div>
      </div>
    </Link>
  )
}
4. Componente ProjectStatusBadge
File: components/projects/project-status-badge.tsx
typescript
'use client'

import { useTranslations } from 'next-intl'

interface ProjectStatusBadgeProps {
  status: string
}

export function ProjectStatusBadge({ status }: ProjectStatusBadgeProps) {
  const t = useTranslations('projects')
  
  // Colores en HSL
  const colors: Record<string, string> = {
    DRAFT: 'bg-slate-100 text-slate-800',
    ACTIVE: 'bg-green-100 text-green-800',
    ON_HOLD: 'bg-orange-100 text-orange-800',
    COMPLETE: 'bg-blue-100 text-blue-800',
  }
  
  const labels: Record<string, string> = {
    DRAFT: t('statusDraft'),
    ACTIVE: t('statusActive'),
    ON_HOLD: t('statusOnHold'),
    COMPLETE: t('statusComplete'),
  }
  
  return (
    <span
      className={`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${
        colors[status] || colors.DRAFT
      }`}
    >
      {labels[status] || status}
    </span>
  )
}
5. Componente ProjectPhaseBadge
File: components/projects/project-phase-badge.tsx
typescript
'use client'

import { useTranslations } from 'next-intl'

interface ProjectPhaseBadgeProps {
  phase: string
}

export function ProjectPhaseBadge({ phase }: ProjectPhaseBadgeProps) {
  const t = useTranslations('projects')
  
  // Colores en HSL
  const colors: Record<string, string> = {
    PRE_CONSTRUCTION: 'bg-purple-100 text-purple-800',
    CONSTRUCTION: 'bg-blue-100 text-blue-800',
    CLOSEOUT: 'bg-slate-100 text-slate-800',
  }
  
  const labels: Record<string, string> = {
    PRE_CONSTRUCTION: t('phasePreConstruction'),
    CONSTRUCTION: t('phaseConstruction'),
    CLOSEOUT: t('phaseCloseout'),
  }
  
  return (
    <span
      className={`inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ${
        colors[phase] || colors.PRE_CONSTRUCTION
      }`}
    >
      {labels[phase] || phase}
    </span>
  )
}
6. Actualizar traducciones
File: messages/es.json
Agregar en la secciÃ³n projects:
json
{
  "projects": {
    "title": "Proyectos",
    "subtitle": "Gestiona todos tus proyectos de construcciÃ³n",
    "newProject": "Nuevo Proyecto",
    "searchPlaceholder": "Buscar por nombre o nÃºmero...",
    "projectNumber": "NÃºmero",
    "name": "Nombre",
    "client": "Cliente",
    "phase": "Fase",
    "status": "Estado",
    "budget": "Presupuesto",
    "actions": "Acciones",
    "view": "Ver",
    "edit": "Editar",
    "delete": "Eliminar",
    "statusAll": "Todos los estados",
    "statusDraft": "Borrador",
    "statusActive": "Activo",
    "statusOnHold": "En Pausa",
    "statusComplete": "Completo",
    "phaseAll": "Todas las fases",
    "phasePreConstruction": "Pre-construcciÃ³n",
    "phaseConstruction": "ConstrucciÃ³n",
    "phaseCloseout": "Cierre",
    "showing": "Mostrando",
    "of": "de",
    "projects": "proyectos",
    "noResults": "No se encontraron proyectos",
    "noProjectsYet": "AÃºn no hay proyectos. Crea uno para comenzar."
  }
}
7. Actualizar Server Action
File: app/actions/projects.ts (REVISAR - no sobrescribir si ya existe)
Asegurar que exista la funciÃ³n listProjects:
typescript
export async function listProjects(
  orgId: string,
  filters?: {
    status?: string
    phase?: string
    search?: string
  }
) {
  'use server'
  
  const where: any = { orgId, active: true }
  
  if (filters?.status && filters.status !== 'all') {
    where.status = filters.status
  }
  
  if (filters?.phase && filters.phase !== 'all') {
    where.phase = filters.phase
  }
  
  if (filters?.search) {
    where.OR = [
      { name: { contains: filters.search, mode: 'insensitive' } },
      { projectNumber: { contains: filters.search, mode: 'insensitive' } },
      { clientName: { contains: filters.search, mode: 'insensitive' } },
    ]
  }
  
  const projects = await prisma.project.findMany({
    where,
    orderBy: { createdAt: 'desc' },
    select: {
      id: true,
      projectNumber: true,
      name: true,
      clientName: true,
      phase: true,
      status: true,
      totalBudget: true,
      location: true,
      startDate: true,
      createdAt: true,
    },
  })
  
  return projects
}
8. Instalar dependencia TanStack Table
bash
# En apps/web
pnpm add @tanstack/react-table
Acceptance Criteria:
â€¢	âœ“ Tabla muestra proyectos con datos reales
â€¢	âœ“ Sorting funciona en columnas (nÃºmero, nombre, presupuesto)
â€¢	âœ“ Filtros funcionan (status, phase, search)
â€¢	âœ“ URL se actualiza con parÃ¡metros de bÃºsqueda
â€¢	âœ“ Toggle tabla/grid funciona
â€¢	âœ“ Cards en grid muestran info resumida
â€¢	âœ“ Badges de status y phase con colores HSL
â€¢	âœ“ Todo en espaÃ±ol
â€¢	âœ“ Responsive en mobile
â€¢	âœ“ Click en proyecto navega a detalle
Testing:
1.	Navegar a /projects
2.	Verificar que muestra lista de proyectos
3.	Buscar por nombre â†’ Debe filtrar
4.	Cambiar filtro de estado â†’ Debe filtrar
5.	Click en columna "Nombre" â†’ Debe ordenar
6.	Toggle a vista grid â†’ Debe mostrar cards
7.	Click en un proyecto â†’ Debe navegar a /projects/[id]
â€ƒ
â€ƒ
â€ƒ
*Context:*
Ver arquitectura completa en @docs/04-implementation/frontend-architecture.md
PROMPT 22: Dashboard de Proyecto Individual
Goal: Crear dashboard especÃ­fico de proyecto con KPIs, grÃ¡fico de avance, resumen de presupuesto, alertas del proyecto y actividad reciente.
Context:
El dashboard del proyecto es la landing page cuando se entra a un proyecto especÃ­fico. Debe mostrar informaciÃ³n clave: estado del presupuesto (planned vs actual), progreso fÃ­sico, certificaciones, cambios pendientes, RFIs abiertos, y actividad reciente del proyecto.
IMPORTANTE - NO MODIFICAR:
â€¢	âŒ No tocar server actions existentes
â€¢	âŒ No modificar lÃ³gica de backend
â€¢	âœ… Usar datos reales desde Prisma
â€¢	âœ… Usar traducciones desde messages/es.json
â€¢	âœ… Usar Recharts para grÃ¡ficos
â€¢	âœ… Colores en formato HSL
Requisitos:
1. PÃ¡gina Dashboard del Proyecto
File: app/[locale]/(dashboard)/projects/[id]/page.tsx
typescript
import { getSession } from '@/lib/session'
import { getOrgContext } from '@/lib/org-context'
import { redirect, notFound } from 'next/navigation'
import { getProjectDashboard } from '@/app/actions/project-dashboard'
import { ProjectHeader } from '@/components/projects/project-header'
import { ProjectKPICards } from '@/components/projects/project-kpi-cards'
import { BudgetProgressChart } from '@/components/projects/budget-progress-chart'
import { ProjectAlertsWidget } from '@/components/projects/project-alerts-widget'
import { ProjectActivityFeed } from '@/components/projects/project-activity-feed'
import { QuickActionsCard } from '@/components/projects/quick-actions-card'
import { getTranslations } from 'next-intl/server'

export default async function ProjectDashboardPage({
  params,
}: {
  params: { locale: string; id: string }
}) {
  const session = await getSession()
  if (!session?.user?.id) redirect(`/${params.locale}/login`)
  
  const orgContext = await getOrgContext(session.user.id)
  if (!orgContext) redirect(`/${params.locale}/login`)
  
  const t = await getTranslations('projectDashboard')
  
  // Fetch project dashboard data
  const dashboardData = await getProjectDashboard(params.id, orgContext.orgId)
  
  if (!dashboardData) {
    notFound()
  }
  
  const { project, kpis, budgetProgress, alerts, recentActivity } = dashboardData
  
  return (
    <div className="space-y-6 p-6">
      {/* Project header with breadcrumb info */}
      <ProjectHeader project={project} />
      
      {/* KPI Cards */}
      <ProjectKPICards kpis={kpis} />
      
      {/* Main content grid */}
      <div className="grid grid-cols-1 gap-6 lg:grid-cols-3">
        {/* Budget progress chart - 2 columns */}
        <div className="lg:col-span-2 space-y-6">
          <BudgetProgressChart 
            data={budgetProgress} 
            projectId={params.id}
          />
          
          {/* Recent activity */}
          <ProjectActivityFeed activities={recentActivity} />
        </div>
        
        {/* Sidebar - 1 column */}
        <div className="space-y-6">
          {/* Quick actions */}
          <QuickActionsCard 
            projectId={params.id}
            canEdit={['EDITOR', 'ADMIN', 'OWNER'].includes(orgContext.role)}
          />
          
          {/* Alerts */}
          <ProjectAlertsWidget alerts={alerts} projectId={params.id} />
        </div>
      </div>
    </div>
  )
}
2. Server Actions para Dashboard del Proyecto
File: app/actions/project-dashboard.ts (NUEVO)
typescript
'use server'

import { prisma } from '@repo/database'
import { Decimal } from '@prisma/client/runtime/library'

export async function getProjectDashboard(projectId: string, orgId: string) {
  // Verificar que el proyecto pertenece a la org
  const project = await prisma.project.findFirst({
    where: { id: projectId, orgId, active: true },
    select: {
      id: true,
      projectNumber: true,
      name: true,
      clientName: true,
      location: true,
      phase: true,
      status: true,
      startDate: true,
      plannedEndDate: true,
      totalBudget: true,
    },
  })
  
  if (!project) return null
  
  // KPIs del proyecto
  const kpis = await getProjectKPIs(projectId, orgId)
  
  // Progreso del presupuesto (planned vs actual por WBS)
  const budgetProgress = await getBudgetProgress(projectId, orgId)
  
  // Alertas del proyecto
  const alerts = await getProjectAlerts(projectId, orgId)
  
  // Actividad reciente del proyecto
  const recentActivity = await getProjectActivity(projectId, orgId)
  
  return {
    project,
    kpis,
    budgetProgress,
    alerts,
    recentActivity,
  }
}

async function getProjectKPIs(projectId: string, orgId: string) {
  // 1. Presupuesto baseline (suma de budget lines de versiÃ³n BASELINE)
  const baselineBudget = await prisma.budgetLine.aggregate({
    where: {
      orgId,
      budgetVersion: {
        projectId,
        versionType: 'BASELINE',
      },
    },
    _sum: { directCostTotal: true },
  })
  
  const totalBudget = Number(baselineBudget._sum.directCostTotal || 0)
  
  // 2. Costo actual (suma de finance lines aprobadas/pagadas)
  const actualCost = await prisma.financeLine.aggregate({
    where: {
      orgId,
      transaction: {
        projectId,
        status: { in: ['APPROVED', 'PAID'] },
        deleted: false,
      },
    },
    _sum: { lineTotal: true },
  })
  
  const totalActual = Number(actualCost._sum.lineTotal || 0)
  
  // 3. Varianza presupuestaria
  const variance = totalActual - totalBudget
  const variancePercentage = totalBudget > 0 ? (variance / totalBudget) * 100 : 0
  
  // 4. Certificaciones aprobadas (suma de period amounts)
  const certifications = await prisma.certification.findMany({
    where: {
      projectId,
      orgId,
      status: 'APPROVED',
    },
    include: {
      lines: {
        select: { periodAmount: true },
      },
    },
  })
  
  const totalCertified = certifications.reduce((sum, cert) => {
    const certTotal = cert.lines.reduce(
      (lineSum, line) => lineSum.add(line.periodAmount),
      new Decimal(0)
    )
    return sum + Number(certTotal)
  }, 0)
  
  // 5. Ã“rdenes de cambio pendientes
  const pendingChangeOrders = await prisma.changeOrder.count({
    where: {
      projectId,
      orgId,
      status: { in: ['DRAFT', 'SUBMITTED'] },
    },
  })
  
  // 6. RFIs abiertos
  const openRFIs = await prisma.rFI.count({
    where: {
      projectId,
      orgId,
      status: { in: ['OPEN', 'ANSWERED'] },
    },
  })
  
  // 7. Progreso fÃ­sico (Ãºltima actualizaciÃ³n de progress)
  const latestProgress = await prisma.progressUpdate.findFirst({
    where: { projectId, orgId },
    orderBy: { asOfDate: 'desc' },
    select: { progressPct: true },
  })
  
  const physicalProgress = Number(latestProgress?.progressPct || 0)
  
  return {
    totalBudget,
    totalActual,
    variance,
    variancePercentage,
    totalCertified,
    pendingChangeOrders,
    openRFIs,
    physicalProgress,
  }
}

async function getBudgetProgress(projectId: string, orgId: string) {
  // Obtener WBS items con presupuesto y costo actual
  const wbsItems = await prisma.wbsNode.findMany({
    where: {
      projectId,
      orgId,
      active: true,
      parentId: null, // Solo nodos raÃ­z (PHASE)
    },
    orderBy: { code: 'asc' },
    select: {
      id: true,
      code: true,
      name: true,
    },
  })
  
  const progressData = await Promise.all(
    wbsItems.map(async (wbs) => {
      // Presupuesto planeado (sum de budget lines para este WBS y sus hijos)
      const budgetLines = await prisma.budgetLine.findMany({
        where: {
          orgId,
          wbsNode: {
            OR: [
              { id: wbs.id },
              { code: { startsWith: wbs.code + '.' } },
            ],
            projectId,
          },
          budgetVersion: {
            versionType: 'BASELINE',
          },
        },
        select: { directCostTotal: true },
      })
      
      const planned = budgetLines.reduce(
        (sum, line) => sum.add(line.directCostTotal),
        new Decimal(0)
      )
      
      // Costo actual (sum de finance lines)
      const financeLines = await prisma.financeLine.findMany({
        where: {
          orgId,
          wbsNode: {
            OR: [
              { id: wbs.id },
              { code: { startsWith: wbs.code + '.' } },
            ],
            projectId,
          },
          transaction: {
            status: { in: ['APPROVED', 'PAID'] },
            deleted: false,
          },
        },
        select: { lineTotal: true },
      })
      
      const actual = financeLines.reduce(
        (sum, line) => sum.add(line.lineTotal),
        new Decimal(0)
      )
      
      return {
        wbsCode: wbs.code,
        wbsName: wbs.name,
        planned: Number(planned),
        actual: Number(actual),
        variance: Number(actual) - Number(planned),
      }
    })
  )
  
  return progressData.filter((item) => item.planned > 0)
}

async function getProjectAlerts(projectId: string, orgId: string) {
  const alerts: Array<{
    id: string
    type: 'warning' | 'error' | 'info'
    title: string
    message: string
    link?: string
  }> = []
  
  // 1. Presupuesto excedido en algÃºn WBS
  const wbsWithBudgetIssues = await prisma.wbsNode.findMany({
    where: {
      projectId,
      orgId,
      active: true,
    },
    select: { id: true, name: true, code: true },
  })
  
  for (const wbs of wbsWithBudgetIssues) {
    const budgetSum = await prisma.budgetLine.aggregate({
      where: {
        wbsNodeId: wbs.id,
        budgetVersion: { versionType: 'BASELINE' },
      },
      _sum: { directCostTotal: true },
    })
    
    const actualSum = await prisma.financeLine.aggregate({
      where: {
        wbsNodeId: wbs.id,
        transaction: {
          status: { in: ['APPROVED', 'PAID'] },
          deleted: false,
        },
      },
      _sum: { lineTotal: true },
    })
    
    const planned = Number(budgetSum._sum.directCostTotal || 0)
    const actual = Number(actualSum._sum.lineTotal || 0)
    
    if (planned > 0 && actual > planned * 1.05) {
      alerts.push({
        id: `budget-exceeded-${wbs.id}`,
        type: 'error',
        title: 'Presupuesto excedido',
        message: `${wbs.code} - ${wbs.name} ha superado el presupuesto en un ${(((actual - planned) / planned) * 100).toFixed(0)}%`,
        link: `/projects/${projectId}/budget`,
      })
    }
  }
  
  // 2. Certificaciones pendientes de aprobaciÃ³n
  const pendingCerts = await prisma.certification.count({
    where: {
      projectId,
      orgId,
      status: 'ISSUED',
    },
  })
  
  if (pendingCerts > 0) {
    alerts.push({
      id: 'pending-certs',
      type: 'warning',
      title: 'Certificaciones pendientes',
      message: `${pendingCerts} certificaciÃ³n(es) esperando aprobaciÃ³n`,
      link: `/projects/${projectId}/certifications`,
    })
  }
  
  // 3. Ã“rdenes de cambio sin procesar
  const pendingCOs = await prisma.changeOrder.count({
    where: {
      projectId,
      orgId,
      status: 'SUBMITTED',
    },
  })
  
  if (pendingCOs > 0) {
    alerts.push({
      id: 'pending-cos',
      type: 'info',
      title: 'Ã“rdenes de cambio pendientes',
      message: `${pendingCOs} orden(es) de cambio esperando revisiÃ³n`,
      link: `/projects/${projectId}/change-orders`,
    })
  }
  
  // 4. RFIs vencidos (>7 dÃ­as abiertos)
  const sevenDaysAgo = new Date()
  sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7)
  
  const overdueRFIs = await prisma.rFI.count({
    where: {
      projectId,
      orgId,
      status: 'OPEN',
      createdAt: { lt: sevenDaysAgo },
    },
  })
  
  if (overdueRFIs > 0) {
    alerts.push({
      id: 'overdue-rfis',
      type: 'warning',
      title: 'RFIs sin responder',
      message: `${overdueRFIs} RFI(s) abiertos hace mÃ¡s de 7 dÃ­as`,
      link: `/projects/${projectId}/quality/rfis`,
    })
  }
  
  // 5. Fecha de finalizaciÃ³n cercana
  const project = await prisma.project.findUnique({
    where: { id: projectId },
    select: { plannedEndDate: true },
  })
  
  if (project?.plannedEndDate) {
    const daysUntilEnd = Math.ceil(
      (new Date(project.plannedEndDate).getTime() - new Date().getTime()) /
        (1000 * 60 * 60 * 24)
    )
    
    if (daysUntilEnd > 0 && daysUntilEnd <= 30) {
      alerts.push({
        id: 'deadline-approaching',
        type: 'warning',
        title: 'Fecha de finalizaciÃ³n cercana',
        message: `El proyecto finaliza en ${daysUntilEnd} dÃ­as`,
      })
    } else if (daysUntilEnd < 0) {
      alerts.push({
        id: 'deadline-passed',
        type: 'error',
        title: 'Fecha de finalizaciÃ³n superada',
        message: `El proyecto debiÃ³ finalizar hace ${Math.abs(daysUntilEnd)} dÃ­as`,
      })
    }
  }
  
  return alerts.slice(0, 5)
}

async function getProjectActivity(projectId: string, orgId: string) {
  const activities = await prisma.auditLog.findMany({
    where: { projectId, orgId },
    orderBy: { createdAt: 'desc' },
    take: 10,
    include: {
      actorUser: {
        select: { fullName: true },
      },
    },
  })
  
  return activities.map((activity) => ({
    id: activity.id,
    action: activity.action,
    entityType: activity.entityType,
    actorName: activity.actorUser?.fullName || 'Sistema',
    createdAt: activity.createdAt,
    details: activity.detailsJson,
  }))
}
3. Componente Project Header
File: components/projects/project-header.tsx
typescript
'use client'

import { useTranslations } from 'next-intl'
import { ProjectStatusBadge } from './project-status-badge'
import { ProjectPhaseBadge } from './project-phase-badge'
import { MapPin, Calendar, User } from 'lucide-react'

interface ProjectHeaderProps {
  project: {
    projectNumber: string
    name: string
    clientName: string | null
    location: string | null
    phase: string
    status: string
    startDate: Date | null
    plannedEndDate: Date | null
  }
}

export function ProjectHeader({ project }: ProjectHeaderProps) {
  const t = useTranslations('projectDashboard')
  
  return (
    <div className="rounded-lg border border-slate-200 bg-white p-6 shadow-sm">
      <div className="flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between">
        <div className="flex-1">
          <div className="flex items-center gap-3">
            <span className="text-sm font-medium text-slate-500">
              {project.projectNumber}
            </span>
            <ProjectStatusBadge status={project.status} />
            <ProjectPhaseBadge phase={project.phase} />
          </div>
          
          <h1 className="mt-2 text-2xl font-semibold text-slate-900">
            {project.name}
          </h1>
          
          <div className="mt-4 flex flex-wrap gap-4">
            {project.clientName && (
              <div className="flex items-center gap-2 text-sm text-slate-600">
                <User className="h-4 w-4" />
                <span>{project.clientName}</span>
              </div>
            )}
            
            {project.location && (
              <div className="flex items-center gap-2 text-sm text-slate-600">
                <MapPin className="h-4 w-4" />
                <span>{project.location}</span>
              </div>
            )}
            
            {project.startDate && (
              <div className="flex items-center gap-2 text-sm text-slate-600">
                <Calendar className="h-4 w-4" />
                <span>
                  {new Date(project.startDate).toLocaleDateString('es-AR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                  })}
                  {project.plannedEndDate && (
                    <>
                      {' - '}
                      {new Date(project.plannedEndDate).toLocaleDateString('es-AR', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                      })}
                    </>
                  )}
                </span>
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  )
}
4. Componente Project KPI Cards
File: components/projects/project-kpi-cards.tsx
typescript
'use client'

import { useTranslations } from 'next-intl'
import { formatCurrency } from '@/lib/format-utils'
import { 
  DollarSign, 
  TrendingUp, 
  FileCheck, 
  AlertCircle,
  CheckCircle2,
  Activity 
} from 'lucide-react'

interface ProjectKPICardsProps {
  kpis: {
    totalBudget: number
    totalActual: number
    variance: number
    variancePercentage: number
    totalCertified: number
    pendingChangeOrders: number
    openRFIs: number
    physicalProgress: number
  }
}

export function ProjectKPICards({ kpis }: ProjectKPICardsProps) {
  const t = useTranslations('projectDashboard')
  
  const varianceStatus = kpis.variancePercentage > 5 ? 'over' : kpis.variancePercentage < -5 ? 'under' : 'on_track'
  
  const cards = [
    {
      title: t('kpiTotalBudget'),
      value: formatCurrency(kpis.totalBudget),
      icon: DollarSign,
      color: 'hsl(217 91% 60%)', // blue-500
      bgColor: 'hsl(217 91% 95%)', // blue-50
    },
    {
      title: t('kpiActualCost'),
      value: formatCurrency(kpis.totalActual),
      subtitle: `${kpis.variancePercentage > 0 ? '+' : ''}${kpis.variancePercentage.toFixed(1)}% ${t('vsPlanned')}`,
      icon: TrendingUp,
      color: varianceStatus === 'over' ? 'hsl(0 84% 60%)' : varianceStatus === 'under' ? 'hsl(142 76% 36%)' : 'hsl(217 91% 60%)',
      bgColor: varianceStatus === 'over' ? 'hsl(0 84% 95%)' : varianceStatus === 'under' ? 'hsl(142 76% 95%)' : 'hsl(217 91% 95%)',
    },
    {
      title: t('kpiCertified'),
      value: formatCurrency(kpis.totalCertified),
      subtitle: `${((kpis.totalCertified / kpis.totalBudget) * 100).toFixed(1)}% ${t('ofBudget')}`,
      icon: FileCheck,
      color: 'hsl(142 76% 36%)', // green-600
      bgColor: 'hsl(142 76% 95%)', // green-50
    },
    {
      title: t('kpiPhysicalProgress'),
      value: `${kpis.physicalProgress.toFixed(1)}%`,
      icon: Activity,
      color: 'hsl(262 83% 58%)', // purple-500
      bgColor: 'hsl(262 83% 95%)', // purple-50
    },
    {
      title: t('kpiPendingCOs'),
      value: kpis.pendingChangeOrders,
      icon: AlertCircle,
      color: 'hsl(25 95% 53%)', // orange-500
      bgColor: 'hsl(25 95% 95%)', // orange-50
    },
    {
      title: t('kpiOpenRFIs'),
      value: kpis.openRFIs,
      icon: CheckCircle2,
      color: 'hsl(199 89% 48%)', // cyan-500
      bgColor: 'hsl(199 89% 95%)', // cyan-50
    },
  ]
  
  return (
    <div className="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6">
      {cards.map((card) => (
        <div
          key={card.title}
          className="rounded-lg border border-slate-200 bg-white p-4 shadow-sm"
        >
          <div className="flex items-center justify-between">
            <div className="flex-1 min-w-0">
              <p className="truncate text-xs font-medium text-slate-600">
                {card.title}
              </p>
              <p className="mt-1 text-2xl font-semibold text-slate-900">
                {card.value}
              </p>
              {card.subtitle && (
                <p className="mt-1 text-xs text-slate-500">
                  {card.subtitle}
                </p>
              )}
            </div>
            <div 
              className="rounded-lg p-2"
              style={{ backgroundColor: card.bgColor }}
            >
              <card.icon className="h-5 w-5" style={{ color: card.color }} />
            </div>
          </div>
        </div>
      ))}
    </div>
  )
}
5. Componente Budget Progress Chart
File: components/projects/budget-progress-chart.tsx
typescript
'use client'

import { useTranslations } from 'next-intl'
import { formatCurrency } from '@/lib/format-utils'
import { Link } from '@/i18n/navigation'
import { Button } from '@/components/ui/button'
import { ExternalLink } from 'lucide-react'
import {
  BarChart,
  Bar,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  Legend,
  ResponsiveContainer,
} from 'recharts'

interface BudgetProgressChartProps {
  data: Array<{
    wbsCode: string
    wbsName: string
    planned: number
    actual: number
    variance: number
  }>
  projectId: string
}

export function BudgetProgressChart({ data, projectId }: BudgetProgressChartProps) {
  const t = useTranslations('projectDashboard')
  
  // Formatear datos para el grÃ¡fico
  const chartData = data.map((item) => ({
    name: item.wbsCode,
    fullName: item.wbsName,
    [t('planned')]: item.planned,
    [t('actual')]: item.actual,
  }))
  
  return (
    <div className="rounded-lg border border-slate-200 bg-white p-6 shadow-sm">
      <div className="flex items-center justify-between">
        <div>
          <h3 className="text-lg font-semibold text-slate-900">
            {t('budgetProgressTitle')}
          </h3>
          <p className="mt-1 text-sm text-slate-500">
            {t('budgetProgressSubtitle')}
          </p>
        </div>
        
        <Button asChild variant="outline" size="sm">
          <Link href={`/projects/${projectId}/budget`}>
            {t('viewDetails')}
            <ExternalLink className="ml-2 h-4 w-4" />
          </Link>
        </Button>
      </div>
      
      <div className="mt-6 h-80">
        {chartData.length > 0 ? (
          <ResponsiveContainer width="100%" height="100%">
            <BarChart data={chartData}>
              <CartesianGrid strokeDasharray="3 3" stroke="hsl(214 32% 91%)" />
              <XAxis 
                dataKey="name" 
                stroke="hsl(215 16% 47%)"
                fontSize={12}
              />
              <YAxis 
                stroke="hsl(215 16% 47%)"
                fontSize={12}
                tickFormatter={(value) => formatCurrency(value, 'es-AR', 'ARS', true)}
              />
              <Tooltip
                contentStyle={{
                  backgroundColor: 'hsl(0 0% 100%)',
                  border: '1px solid hsl(214 32% 91%)',
                  borderRadius: '8px',
                }}
                formatter={(value: number) => formatCurrency(value)}
                labelFormatter={(label, payload) => {
                  const item = payload?.[0]?.payload
                  return item?.fullName || label
                }}
              />
              <Legend />
              <Bar 
                dataKey={t('planned')} 
                fill="hsl(217 91% 60%)" 
                radius={[4, 4, 0, 0]}
              />
              <Bar 
                dataKey={t('actual')} 
                fill="hsl(142 76% 36%)" 
                radius={[4, 4, 0, 0]}
              />
            </BarChart>
          </ResponsiveContainer>
        ) : (
          <div className="flex h-full items-center justify-center text-slate-500">
            {t('noBudgetData')}
          </div>
        )}
      </div>
    </div>
  )
}
6. Componente Quick Actions Card
File: components/projects/quick-actions-card.tsx
typescript
'use client'

import { useTranslations } from 'next-intl'
import { Link } from '@/i18n/navigation'
import { Button } from '@/components/ui/button'
import { 
  DollarSign, 
  FileText, 
  Calendar, 
  Receipt,
  MessageSquare,
  FileCheck 
} from 'lucide-react'

interface QuickActionsCardProps {
  projectId: string
  canEdit: boolean
}

export function QuickActionsCard({ projectId, canEdit }: QuickActionsCardProps) {
  const t = useTranslations('projectDashboard')
  
  const actions = [
    {
      label: t('actionViewBudget'),
      href: `/projects/${projectId}/budget`,
      icon: DollarSign,
    },
    {
      label: t('actionViewSchedule'),
      href: `/projects/${projectId}/schedule`,
      icon: Calendar,
    },
    {
      label: t('actionViewTransactions'),
      href: `/projects/${projectId}/finance/transactions`,
      icon: Receipt,
    },
    {
      label: t('actionViewCertifications'),
      href: `/projects/${projectId}/certifications`,
      icon: FileCheck,
    },
    {
      label: t('actionViewRFIs'),
      href: `/projects/${projectId}/quality/rfis`,
      icon: MessageSquare,
    },
    {
      label: t('actionViewDocuments'),
      href: `/projects/${projectId}/documents`,
      icon: FileText,
    },
  ]
  
  return (
    <div className="rounded-lg border border-slate-200 bg-white p-6 shadow-sm">
      <h3 className="text-lg font-semibold text-slate-900">
        {t('quickActionsTitle')}
      </h3>
      
      <div className="mt-4 space-y-2">
        {actions.map((action) => (
          <Button
            key={action.href}
            asChild
            variant="outline"
            className="w-full justify-start"
          >
            <Link href={action.href}>
              <action.icon className="mr-2 h-4 w-4" />
              {action.label}
            </Link>
          </Button>
        ))}
      </div>
    </div>
  )
}
7. Componente Project Alerts Widget
File: components/projects/project-alerts-widget.tsx
typescript
'use client'

import { useTranslations } from 'next-intl'
import { Link } from '@/i18n/navigation'
import { AlertTriangle, XCircle, Info } from 'lucide-react'

interface Alert {
  id: string
  type: 'warning' | 'error' | 'info'
  title: string
  message: string
  link?: string
}

interface ProjectAlertsWidgetProps {
  alerts: Alert[]
  projectId: string
}

export function ProjectAlertsWidget({ alerts, projectId }: ProjectAlertsWidgetProps) {
  const t = useTranslations('projectDashboard')
  
  const iconMap = {
    warning: AlertTriangle,
    error: XCircle,
    info: Info,
  }
  
  const colorMap = {
    warning: 'text-orange-600 bg-orange-50',
    error: 'text-red-600 bg-red-50',
    info: 'text-blue-600 bg-blue-50',
  }
  
  return (
    <div className="rounded-lg border border-slate-200 bg-white p-6 shadow-sm">
      <h3 className="text-lg font-semibold text-slate-900">
        {t('alertsTitle')}
      </h3>
      
      {alerts.length === 0 ? (
        <p className="mt-4 text-sm text-slate-500">
          {t('noAlerts')}
        </p>
      ) : (
        <div className="mt-4 space-y-3">
          {alerts.map((alert) => {
            const Icon = iconMap[alert.type]
            const colorClass = colorMap[alert.type]
            
            const content = (
              <div className="flex gap-3">
                <div className={`flex-shrink-0 rounded-lg p-2 ${colorClass}`}>
                  <Icon className="h-5 w-5" />
                </div>
                <div className="flex-1 min-w-0">
                  <p className="text-sm font-medium text-slate-900">
                    {alert.title}
                  </p>
                  <p className="mt-1 text-sm text-slate-600">
                    {alert.message}
                  </p>
                </div>
              </div>
            )
            
            if (alert.link) {
              return (
                <Link
                  key={alert.id}
                  href={alert.link}
                  className="block rounded-lg border border-slate-200 p-3 transition-colors hover:bg-slate-50"
                >
                  {content}
                </Link>
              )
            }
            
            return (
              <div
                key={alert.id}
                className="rounded-lg border border-slate-200 p-3"
              >
                {content}
              </div>
            )
          })}
        </div>
      )}
    </div>
  )
}
8. Componente Project Activity Feed
File: components/projects/project-activity-feed.tsx
typescript
'use client'

import { useTranslations } from 'next-intl'
import { formatDistanceToNow } from 'date-fns'
import { es } from 'date-fns/locale'

interface Activity {
  id: string
  action: string
  entityType: string
  actorName: string
  createdAt: Date
}

interface ProjectActivityFeedProps {
  activities: Activity[]
}

export function ProjectActivityFeed({ activities }: ProjectActivityFeedProps) {
  const t = useTranslations('projectDashboard')
  
  const getActionLabel = (action: string, entityType: string) => {
    const key = `activity_${action}_${entityType}`.toLowerCase()
    return t(key, { defaultValue: `${action} ${entityType}` })
  }
  
  return (
    <div className="rounded-lg border border-slate-200 bg-white p-6 shadow-sm">
      <h3 className="text-lg font-semibold text-slate-900">
        {t('recentActivityTitle')}
      </h3>
      
      {activities.length === 0 ? (
        <p className="mt-4 text-sm text-slate-500">
          {t('noRecentActivity')}
        </p>
      ) : (
        <div className="mt-4 space-y-4">
          {activities.map((activity) => (
            <div
              key={activity.id}
              className="flex items-start gap-3 border-b border-slate-100 pb-3 last:border-0 last:pb-0"
            >
              <div className="flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full bg-slate-100">
                <span className="text-xs font-medium text-slate-600">
                  {activity.actorName.charAt(0).toUpperCase()}
                </span>
              </div>
              
              <div className="flex-1 min-w-0">
                <p className="text-sm text-slate-900">
                  <span className="font-medium">{activity.actorName}</span>
                  {' '}
                  {getActionLabel(activity.action, activity.entityType)}
                </p>
                <p className="mt-1 text-xs text-slate-500">
                  {formatDistanceToNow(new Date(activity.createdAt), {
                    addSuffix: true,
                    locale: es,
                  })}
                </p>
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  )
}
9. Actualizar traducciones
File: messages/es.json
Agregar nueva secciÃ³n:
json
{
  "projectDashboard": {
    "kpiTotalBudget": "Presupuesto Total",
    "kpiActualCost": "Costo Real",
    "kpiCertified": "Certificado",
    "kpiPhysicalProgress": "Avance FÃ­sico",
    "kpiPendingCOs": "OCs Pendientes",
    "kpiOpenRFIs": "RFIs Abiertos",
    "vsPlanned": "vs planeado",
    "ofBudget": "del presupuesto",
    "budgetProgressTitle": "Progreso del Presupuesto",
    "budgetProgressSubtitle": "ComparaciÃ³n por partida principal",
    "viewDetails": "Ver Detalles",
    "planned": "Planeado",
    "actual": "Real",
    "noBudgetData": "No hay datos de presupuesto disponibles",
    "quickActionsTitle": "Acciones RÃ¡pidas",
    "actionViewBudget": "Ver Presupuesto",
    "actionViewSchedule": "Ver Cronograma",
    "actionViewTransactions": "Ver Transacciones",
    "actionViewCertifications": "Ver Certificaciones",
    "actionViewRFIs": "Ver RFIs",
    "actionViewDocuments": "Ver Documentos",
    "alertsTitle": "Alertas del Proyecto",
    "noAlerts": "No hay alertas",
    "recentActivityTitle": "Actividad Reciente",
    "noRecentActivity": "No hay actividad reciente",
    "activity_create_budgetversion": "creÃ³ una versiÃ³n de presupuesto",
    "activity_approve_budgetversion": "aprobÃ³ el presupuesto",
    "activity_create_certification": "creÃ³ una certificaciÃ³n",
    "activity_approve_certification": "aprobÃ³ una certificaciÃ³n",
    "activity_create_changeorder": "creÃ³ una orden de cambio",
    "activity_approve_changeorder": "aprobÃ³ una orden de cambio",
    "activity_create_financetransaction": "creÃ³ una transacciÃ³n financiera",
    "activity_approve_financetransaction": "aprobÃ³ una transacciÃ³n"
  }
}
Acceptance Criteria:
â€¢	âœ“ Dashboard muestra informaciÃ³n real del proyecto
â€¢	âœ“ KPIs calculan correctamente desde datos
â€¢	âœ“ GrÃ¡fico de presupuesto muestra planned vs actual por WBS
â€¢	âœ“ Alertas se generan segÃºn reglas de negocio
â€¢	âœ“ Feed de actividad muestra Ãºltimas acciones del proyecto
â€¢	âœ“ Quick actions permiten navegar a mÃ³dulos
â€¢	âœ“ Todo en espaÃ±ol con formato ARS
â€¢	âœ“ Responsive en mobile
â€¢	âœ“ Colores en formato HSL
Testing:
1.	Navegar a /projects/[id]
2.	Verificar que KPIs muestran datos correctos
3.	Verificar grÃ¡fico de presupuesto (debe haber datos)
4.	Crear alertas artificiales (exceder presupuesto)
5.	Verificar que alertas aparecen
6.	Click en quick actions â†’ Debe navegar correctamente
7.	Verificar actividad reciente






























# Frontend Implementation - Prompts 23-26

ContinuaciÃ³n despuÃ©s de implementar navegaciÃ³n dual (Prompts 19-22).

---

## **Prompt 23: Organization Settings & User Profile**

**Goal:** Implement complete settings module with organization configuration, user profile, and team management.

**Context:**
Settings is accessible from both Global and Project contexts. Includes organization data, user profile, team management, and billing (future).

Reference: @MASTER_PLAN section "MÃ³dulo 1: Perfil y ConfiguraciÃ³n"

---

### **Files to CREATE:**

#### 1. Settings Layout

**File:** `apps/web/app/[locale]/(dashboard)/settings/layout.tsx` (NEW)

```typescript
import { getSession } from '@/lib/session'
import { getOrgContext } from '@/lib/org-context'
import { redirect } from 'next/navigation'
import { SettingsSidebar } from '@/components/settings/settings-sidebar'

export default async function SettingsLayout({
  children,
}: {
  children: React.ReactNode
}) {
  const session = await getSession()
  if (!session?.user?.id) redirect('/login')

  const { orgId, role } = await getOrgContext(session.user.id)

  return (
    <div className="flex h-full">
      <SettingsSidebar role={role} />
      <div className="flex-1 overflow-y-auto">
        {children}
      </div>
    </div>
  )
}
```

#### 2. Settings Sidebar

**File:** `components/settings/settings-sidebar.tsx` (NEW)

```typescript
'use client'

import { useTranslations } from 'next-intl'
import { Link, usePathname } from '@/i18n/navigation'
import { cn } from '@/lib/utils'
import {
  Building2,
  User,
  Users,
  CreditCard,
  Bell,
  Shield,
} from 'lucide-react'

interface SettingsSidebarProps {
  role: string
}

export function SettingsSidebar({ role }: SettingsSidebarProps) {
  const t = useTranslations('settings')
  const pathname = usePathname()

  const sections = [
    {
      items: [
        { 
          key: 'profile', 
          href: '/settings/profile', 
          icon: User,
          roles: ['VIEWER', 'ACCOUNTANT', 'EDITOR', 'ADMIN', 'OWNER']
        },
        { 
          key: 'organization', 
          href: '/settings/organization', 
          icon: Building2,
          roles: ['ADMIN', 'OWNER']
        },
        { 
          key: 'team', 
          href: '/settings/team', 
          icon: Users,
          roles: ['ADMIN', 'OWNER']
        },
      ]
    },
    {
      label: t('preferences'),
      items: [
        { 
          key: 'notifications', 
          href: '/settings/notifications', 
          icon: Bell,
          roles: ['VIEWER', 'ACCOUNTANT', 'EDITOR', 'ADMIN', 'OWNER']
        },
      ]
    },
    {
      label: t('billing'),
      items: [
        { 
          key: 'subscription', 
          href: '/settings/subscription', 
          icon: CreditCard,
          roles: ['OWNER']
        },
        { 
          key: 'security', 
          href: '/settings/security', 
          icon: Shield,
          roles: ['OWNER']
        },
      ]
    },
  ]

  return (
    <nav className="w-64 border-r border-border bg-muted/30 p-6">
      <h2 className="mb-6 text-lg font-semibold">{t('settings')}</h2>
      
      <div className="space-y-6">
        {sections.map((section, index) => (
          <div key={index}>
            {section.label && (
              <p className="mb-2 text-xs font-medium text-muted-foreground uppercase">
                {section.label}
              </p>
            )}
            <div className="space-y-1">
              {section.items
                .filter(item => item.roles.includes(role))
                .map((item) => {
                  const Icon = item.icon
                  const isActive = pathname === item.href

                  return (
                    <Link
                      key={item.key}
                      href={item.href}
                      className={cn(
                        'flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium transition-colors',
                        isActive
                          ? 'bg-background text-foreground shadow-sm'
                          : 'text-muted-foreground hover:bg-background/50 hover:text-foreground'
                      )}
                    >
                      <Icon className="h-4 w-4" />
                      {t(item.key)}
                    </Link>
                  )
                })}
            </div>
          </div>
        ))}
      </div>
    </nav>
  )
}
```

#### 3. User Profile Page

**File:** `apps/web/app/[locale]/(dashboard)/settings/profile/page.tsx` (NEW)

```typescript
import { getSession } from '@/lib/session'
import { redirect } from 'next/navigation'
import { prisma } from '@repo/database'
import { UserProfileForm } from '@/components/settings/user-profile-form'
import { PageHeader } from '@/components/layout/page-header'
import { useTranslations } from 'next-intl'

export default async function ProfilePage() {
  const session = await getSession()
  if (!session?.user?.id) redirect('/login')

  const user = await prisma.user.findUnique({
    where: { id: session.user.id },
    select: {
      id: true,
      email: true,
      fullName: true,
      avatarUrl: true,
      locale: true,
      timezone: true,
    },
  })

  if (!user) redirect('/login')

  return (
    <div className="h-full">
      <PageHeader
        title="Perfil de Usuario"
        subtitle="Administra tu informaciÃ³n personal y preferencias"
      />
      
      <div className="p-6">
        <div className="mx-auto max-w-2xl">
          <UserProfileForm user={user} />
        </div>
      </div>
    </div>
  )
}
```

#### 4. User Profile Form

**File:** `components/settings/user-profile-form.tsx` (NEW)

```typescript
'use client'

import { useTranslations } from 'next-intl'
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { updateUserProfileSchema, type UpdateUserProfileInput } from '@repo/validators'
import { updateUserProfile } from '@/app/actions/settings'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { toast } from 'sonner'
import { useState } from 'react'
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'
import { Upload } from 'lucide-react'

interface UserProfileFormProps {
  user: {
    id: string
    email: string
    fullName: string | null
    avatarUrl: string | null
    locale: string | null
    timezone: string | null
  }
}

export function UserProfileForm({ user }: UserProfileFormProps) {
  const t = useTranslations('settings')
  const [isSubmitting, setIsSubmitting] = useState(false)

  const {
    register,
    handleSubmit,
    formState: { errors },
  } = useForm<UpdateUserProfileInput>({
    resolver: zodResolver(updateUserProfileSchema),
    defaultValues: {
      fullName: user.fullName || '',
      email: user.email,
      locale: user.locale || 'es',
      timezone: user.timezone || 'America/Argentina/Buenos_Aires',
    },
  })

  async function onSubmit(data: UpdateUserProfileInput) {
    setIsSubmitting(true)
    try {
      const result = await updateUserProfile(data)
      
      if (result.success) {
        toast.success(t('profileUpdated'))
      } else {
        toast.error(result.error || t('errorUpdating'))
      }
    } catch (error) {
      toast.error(t('errorUpdating'))
    } finally {
      setIsSubmitting(false)
    }
  }

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-8">
      {/* Avatar Section */}
      <div className="flex items-center gap-6">
        <Avatar className="h-24 w-24">
          <AvatarImage src={user.avatarUrl || undefined} />
          <AvatarFallback className="text-2xl">
            {user.fullName?.charAt(0)?.toUpperCase() || user.email.charAt(0).toUpperCase()}
          </AvatarFallback>
        </Avatar>
        
        <div>
          <Button type="button" variant="outline" size="sm">
            <Upload className="mr-2 h-4 w-4" />
            {t('uploadAvatar')}
          </Button>
          <p className="mt-2 text-xs text-muted-foreground">
            {t('avatarHelp')}
          </p>
        </div>
      </div>

      {/* Personal Info */}
      <div className="space-y-4">
        <div>
          <Label htmlFor="fullName">{t('fullName')}</Label>
          <Input
            id="fullName"
            {...register('fullName')}
            error={errors.fullName?.message}
          />
        </div>

        <div>
          <Label htmlFor="email">{t('email')}</Label>
          <Input
            id="email"
            type="email"
            {...register('email')}
            disabled
            className="bg-muted"
          />
          <p className="mt-1 text-xs text-muted-foreground">
            {t('emailNotEditable')}
          </p>
        </div>
      </div>

      {/* Preferences */}
      <div className="space-y-4">
        <h3 className="text-lg font-medium">{t('preferences')}</h3>
        
        <div>
          <Label htmlFor="locale">{t('language')}</Label>
          <select
            id="locale"
            {...register('locale')}
            className="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"
          >
            <option value="es">EspaÃ±ol</option>
            <option value="en">English</option>
          </select>
        </div>

        <div>
          <Label htmlFor="timezone">{t('timezone')}</Label>
          <select
            id="timezone"
            {...register('timezone')}
            className="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"
          >
            <option value="America/Argentina/Buenos_Aires">Buenos Aires (GMT-3)</option>
            <option value="America/Mexico_City">Ciudad de MÃ©xico (GMT-6)</option>
            <option value="America/Santiago">Santiago (GMT-3)</option>
            <option value="America/Bogota">BogotÃ¡ (GMT-5)</option>
            <option value="America/Lima">Lima (GMT-5)</option>
          </select>
        </div>
      </div>

      {/* Actions */}
      <div className="flex justify-end gap-3">
        <Button type="button" variant="outline">
          {t('cancel')}
        </Button>
        <Button type="submit" variant="accent" disabled={isSubmitting}>
          {isSubmitting ? t('saving') : t('saveChanges')}
        </Button>
      </div>
    </form>
  )
}
```

#### 5. Organization Settings Page

**File:** `apps/web/app/[locale]/(dashboard)/settings/organization/page.tsx` (NEW)

```typescript
import { getSession } from '@/lib/session'
import { getOrgContext } from '@/lib/org-context'
import { redirect } from 'next/navigation'
import { prisma } from '@repo/database'
import { OrganizationSettingsForm } from '@/components/settings/organization-settings-form'
import { PageHeader } from '@/components/layout/page-header'

export default async function OrganizationSettingsPage() {
  const session = await getSession()
  if (!session?.user?.id) redirect('/login')

  const { orgId, role } = await getOrgContext(session.user.id)

  // Check permission
  if (!['ADMIN', 'OWNER'].includes(role)) {
    redirect('/dashboard')
  }

  const organization = await prisma.organization.findUnique({
    where: { id: orgId },
    include: {
      profile: true,
    },
  })

  if (!organization) redirect('/dashboard')

  return (
    <div className="h-full">
      <PageHeader
        title="ConfiguraciÃ³n de la OrganizaciÃ³n"
        subtitle="Administra los datos fiscales y configuraciÃ³n de tu empresa"
      />
      
      <div className="p-6">
        <div className="mx-auto max-w-2xl">
          <OrganizationSettingsForm 
            organization={organization}
            profile={organization.profile}
          />
        </div>
      </div>
    </div>
  )
}
```

#### 6. Organization Settings Form

**File:** `components/settings/organization-settings-form.tsx` (NEW)

```typescript
'use client'

import { useTranslations } from 'next-intl'
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { updateOrganizationSchema, type UpdateOrganizationInput } from '@repo/validators'
import { updateOrganization } from '@/app/actions/settings'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Textarea } from '@/components/ui/textarea'
import { toast } from 'sonner'
import { useState } from 'react'

interface OrganizationSettingsFormProps {
  organization: {
    id: string
    name: string
    slug: string
    taxId: string | null
    country: string | null
    city: string | null
    address: string | null
  }
  profile: {
    legalName: string | null
    baseCurrency: string
    defaultTaxPct: number
  } | null
}

export function OrganizationSettingsForm({ 
  organization, 
  profile 
}: OrganizationSettingsFormProps) {
  const t = useTranslations('settings')
  const [isSubmitting, setIsSubmitting] = useState(false)

  const {
    register,
    handleSubmit,
    formState: { errors },
  } = useForm<UpdateOrganizationInput>({
    resolver: zodResolver(updateOrganizationSchema),
    defaultValues: {
      name: organization.name,
      taxId: organization.taxId || '',
      country: organization.country || 'AR',
      city: organization.city || '',
      address: organization.address || '',
      legalName: profile?.legalName || '',
      baseCurrency: profile?.baseCurrency || 'ARS',
      defaultTaxPct: profile?.defaultTaxPct || 21,
    },
  })

  async function onSubmit(data: UpdateOrganizationInput) {
    setIsSubmitting(true)
    try {
      const result = await updateOrganization(data)
      
      if (result.success) {
        toast.success(t('organizationUpdated'))
      } else {
        toast.error(result.error || t('errorUpdating'))
      }
    } catch (error) {
      toast.error(t('errorUpdating'))
    } finally {
      setIsSubmitting(false)
    }
  }

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-8">
      {/* Basic Info */}
      <div className="space-y-4">
        <h3 className="text-lg font-medium">{t('basicInfo')}</h3>
        
        <div>
          <Label htmlFor="name">{t('organizationName')}</Label>
          <Input
            id="name"
            {...register('name')}
            error={errors.name?.message}
          />
        </div>

        <div>
          <Label htmlFor="legalName">{t('legalName')}</Label>
          <Input
            id="legalName"
            {...register('legalName')}
            error={errors.legalName?.message}
          />
          <p className="mt-1 text-xs text-muted-foreground">
            {t('legalNameHelp')}
          </p>
        </div>

        <div>
          <Label htmlFor="slug">{t('slug')}</Label>
          <Input
            id="slug"
            value={organization.slug}
            disabled
            className="bg-muted"
          />
          <p className="mt-1 text-xs text-muted-foreground">
            {t('slugNotEditable')}
          </p>
        </div>
      </div>

      {/* Tax Info */}
      <div className="space-y-4">
        <h3 className="text-lg font-medium">{t('taxInfo')}</h3>
        
        <div>
          <Label htmlFor="taxId">{t('taxId')}</Label>
          <Input
            id="taxId"
            {...register('taxId')}
            placeholder="30-12345678-9"
            error={errors.taxId?.message}
          />
        </div>

        <div>
          <Label htmlFor="country">{t('country')}</Label>
          <select
            id="country"
            {...register('country')}
            className="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"
          >
            <option value="AR">Argentina</option>
            <option value="MX">MÃ©xico</option>
            <option value="CL">Chile</option>
            <option value="CO">Colombia</option>
            <option value="PE">PerÃº</option>
          </select>
        </div>

        <div>
          <Label htmlFor="city">{t('city')}</Label>
          <Input
            id="city"
            {...register('city')}
            error={errors.city?.message}
          />
        </div>

        <div>
          <Label htmlFor="address">{t('address')}</Label>
          <Textarea
            id="address"
            {...register('address')}
            rows={3}
          />
        </div>
      </div>

      {/* Financial Defaults */}
      <div className="space-y-4">
        <h3 className="text-lg font-medium">{t('financialDefaults')}</h3>
        
        <div>
          <Label htmlFor="baseCurrency">{t('baseCurrency')}</Label>
          <select
            id="baseCurrency"
            {...register('baseCurrency')}
            className="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"
          >
            <option value="ARS">ARS - Peso Argentino</option>
            <option value="USD">USD - DÃ³lar Estadounidense</option>
            <option value="EUR">EUR - Euro</option>
            <option value="MXN">MXN - Peso Mexicano</option>
            <option value="CLP">CLP - Peso Chileno</option>
          </select>
        </div>

        <div>
          <Label htmlFor="defaultTaxPct">{t('defaultTaxPct')}</Label>
          <Input
            id="defaultTaxPct"
            type="number"
            step="0.01"
            {...register('defaultTaxPct', { valueAsNumber: true })}
            error={errors.defaultTaxPct?.message}
          />
          <p className="mt-1 text-xs text-muted-foreground">
            {t('defaultTaxPctHelp')}
          </p>
        </div>
      </div>

      {/* Actions */}
      <div className="flex justify-end gap-3">
        <Button type="button" variant="outline">
          {t('cancel')}
        </Button>
        <Button type="submit" variant="accent" disabled={isSubmitting}>
          {isSubmitting ? t('saving') : t('saveChanges')}
        </Button>
      </div>
    </form>
  )
}
```

#### 7. Team Management Page

**File:** `apps/web/app/[locale]/(dashboard)/settings/team/page.tsx` (NEW)

```typescript
import { getSession } from '@/lib/session'
import { getOrgContext } from '@/lib/org-context'
import { redirect } from 'next/navigation'
import { prisma } from '@repo/database'
import { TeamManagement } from '@/components/settings/team-management'
import { PageHeader } from '@/components/layout/page-header'
import { Button } from '@/components/ui/button'
import { Plus } from 'lucide-react'

export default async function TeamPage() {
  const session = await getSession()
  if (!session?.user?.id) redirect('/login')

  const { orgId, role } = await getOrgContext(session.user.id)

  // Check permission
  if (!['ADMIN', 'OWNER'].includes(role)) {
    redirect('/dashboard')
  }

  const members = await prisma.orgMember.findMany({
    where: { orgId },
    include: {
      user: {
        select: {
          id: true,
          email: true,
          fullName: true,
          avatarUrl: true,
        },
      },
    },
    orderBy: { createdAt: 'desc' },
  })

  return (
    <div className="h-full">
      <PageHeader
        title="Equipo"
        subtitle="Administra los miembros de tu organizaciÃ³n"
        actions={
          <Button variant="accent">
            <Plus className="mr-2 h-4 w-4" />
            Invitar Miembro
          </Button>
        }
      />
      
      <div className="p-6">
        <TeamManagement members={members} currentUserRole={role} />
      </div>
    </div>
  )
}
```

#### 8. Team Management Component

**File:** `components/settings/team-management.tsx` (NEW)

```typescript
'use client'

import { useTranslations } from 'next-intl'
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'
import { Badge } from '@/components/ui/badge'
import { Button } from '@/components/ui/button'
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu'
import { MoreHorizontal, Mail, UserX } from 'lucide-react'
import { formatDistanceToNow } from 'date-fns'
import { es } from 'date-fns/locale'

interface TeamManagementProps {
  members: Array<{
    id: string
    role: string
    active: boolean
    createdAt: Date
    user: {
      id: string
      email: string
      fullName: string | null
      avatarUrl: string | null
    }
  }>
  currentUserRole: string
}

const roleColors = {
  OWNER: 'badge-danger',
  ADMIN: 'badge-warning',
  EDITOR: 'badge-info',
  ACCOUNTANT: 'badge-neutral',
  VIEWER: 'badge-neutral',
}

export function TeamManagement({ members, currentUserRole }: TeamManagementProps) {
  const t = useTranslations('settings')

  return (
    <div className="rounded-lg border border-border bg-card">
      <div className="overflow-x-auto">
        <table className="w-full">
          <thead className="border-b border-border bg-muted/50">
            <tr>
              <th className="px-6 py-3 text-left text-xs font-medium uppercase text-muted-foreground">
                {t('member')}
              </th>
              <th className="px-6 py-3 text-left text-xs font-medium uppercase text-muted-foreground">
                {t('role')}
              </th>
              <th className="px-6 py-3 text-left text-xs font-medium uppercase text-muted-foreground">
                {t('status')}
              </th>
              <th className="px-6 py-3 text-left text-xs font-medium uppercase text-muted-foreground">
                {t('joined')}
              </th>
              <th className="px-6 py-3 text-right text-xs font-medium uppercase text-muted-foreground">
                {t('actions')}
              </th>
            </tr>
          </thead>
          <tbody className="divide-y divide-border">
            {members.map((member) => (
              <tr key={member.id} className="hover:bg-muted/30">
                <td className="px-6 py-4">
                  <div className="flex items-center gap-3">
                    <Avatar>
                      <AvatarImage src={member.user.avatarUrl || undefined} />
                      <AvatarFallback>
                        {member.user.fullName?.charAt(0)?.toUpperCase() || 
                         member.user.email.charAt(0).toUpperCase()}
                      </AvatarFallback>
                    </Avatar>
                    <div>
                      <p className="font-medium">
                        {member.user.fullName || member.user.email}
                      </p>
                      <p className="text-sm text-muted-foreground">
                        {member.user.email}
                      </p>
                    </div>
                  </div>
                </td>
                <td className="px-6 py-4">
                  <Badge className={roleColors[member.role as keyof typeof roleColors]}>
                    {t(`role_${member.role.toLowerCase()}`)}
                  </Badge>
                </td>
                <td className="px-6 py-4">
                  {member.active ? (
                    <Badge className="badge-success">
                      {t('active')}
                    </Badge>
                  ) : (
                    <Badge className="badge-neutral">
                      {t('inactive')}
                    </Badge>
                  )}
                </td>
                <td className="px-6 py-4 text-sm text-muted-foreground">
                  {formatDistanceToNow(new Date(member.createdAt), {
                    addSuffix: true,
                    locale: es,
                  })}
                </td>
                <td className="px-6 py-4 text-right">
                  {currentUserRole === 'OWNER' && member.role !== 'OWNER' && (
                    <DropdownMenu>
                      <DropdownMenuTrigger asChild>
                        <Button variant="ghost" size="icon">
                          <MoreHorizontal className="h-4 w-4" />
                        </Button>
                      </DropdownMenuTrigger>
                      <DropdownMenuContent align="end">
                        <DropdownMenuItem>
                          <Mail className="mr-2 h-4 w-4" />
                          {t('resendInvite')}
                        </DropdownMenuItem>
                        <DropdownMenuItem className="text-destructive">
                          <UserX className="mr-2 h-4 w-4" />
                          {t('deactivate')}
                        </DropdownMenuItem>
                      </DropdownMenuContent>
                    </DropdownMenu>
                  )}
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  )
}
```

#### 9. Server Actions

**File:** `apps/web/app/actions/settings.ts` (NEW)

```typescript
'use server'

import { revalidatePath } from 'next/cache'
import { prisma } from '@repo/database'
import { getSession } from '@/lib/session'
import { getOrgContext } from '@/lib/org-context'
import { requireRole } from '@/lib/rbac'
import type { UpdateUserProfileInput, UpdateOrganizationInput } from '@repo/validators'

export async function updateUserProfile(data: UpdateUserProfileInput) {
  const session = await getSession()
  if (!session?.user?.id) throw new Error('Unauthorized')

  try {
    await prisma.user.update({
      where: { id: session.user.id },
      data: {
        fullName: data.fullName,
        locale: data.locale,
        timezone: data.timezone,
      },
    })

    revalidatePath('/settings/profile')
    return { success: true }
  } catch (error) {
    console.error('Error updating profile:', error)
    return { success: false, error: 'Error al actualizar el perfil' }
  }
}

export async function updateOrganization(data: UpdateOrganizationInput) {
  const session = await getSession()
  if (!session?.user?.id) throw new Error('Unauthorized')

  const { orgId, role } = await getOrgContext(session.user.id)
  requireRole(role, 'ADMIN')

  try {
    // Update organization
    await prisma.organization.update({
      where: { id: orgId },
      data: {
        name: data.name,
        taxId: data.taxId,
        country: data.country,
        city: data.city,
        address: data.address,
      },
    })

    // Update profile
    await prisma.orgProfile.upsert({
      where: { orgId },
      create: {
        orgId,
        legalName: data.legalName || data.name,
        baseCurrency: data.baseCurrency || 'ARS',
        defaultTaxPct: data.defaultTaxPct || 21,
      },
      update: {
        legalName: data.legalName,
        baseCurrency: data.baseCurrency,
        defaultTaxPct: data.defaultTaxPct,
      },
    })

    revalidatePath('/settings/organization')
    return { success: true }
  } catch (error) {
    console.error('Error updating organization:', error)
    return { success: false, error: 'Error al actualizar la organizaciÃ³n' }
  }
}

export async function inviteTeamMember(email: string, role: string) {
  const session = await getSession()
  if (!session?.user?.id) throw new Error('Unauthorized')

  const { orgId, role: userRole } = await getOrgContext(session.user.id)
  requireRole(userRole, 'ADMIN')

  try {
    // Check if user already exists
    const existingUser = await prisma.user.findUnique({
      where: { email },
    })

    if (existingUser) {
      // Check if already a member
      const existingMember = await prisma.orgMember.findUnique({
        where: {
          orgId_userId: {
            orgId,
            userId: existingUser.id,
          },
        },
      })

      if (existingMember) {
        return { success: false, error: 'El usuario ya es miembro de esta organizaciÃ³n' }
      }

      // Add as member
      await prisma.orgMember.create({
        data: {
          orgId,
          userId: existingUser.id,
          role,
          active: true,
        },
      })
    } else {
      // Create invitation (implement email sending)
      // For now, just create a pending org member
      await prisma.orgMember.create({
        data: {
          orgId,
          role,
          active: false,
          // Store email temporarily in a separate table for invitations
        },
      })
    }

    revalidatePath('/settings/team')
    return { success: true }
  } catch (error) {
    console.error('Error inviting member:', error)
    return { success: false, error: 'Error al invitar al miembro' }
  }
}
```

#### 10. Update Validators

**File:** `packages/validators/src/settings.ts` (NEW)

```typescript
import { z } from 'zod'

export const updateUserProfileSchema = z.object({
  fullName: z.string().min(1, 'Nombre completo es requerido').max(255),
  email: z.string().email('Email invÃ¡lido'),
  locale: z.enum(['es', 'en']).optional(),
  timezone: z.string().optional(),
})

export const updateOrganizationSchema = z.object({
  name: z.string().min(1, 'Nombre de la organizaciÃ³n es requerido').max(255),
  legalName: z.string().max(255).optional(),
  taxId: z.string().max(50).optional(),
  country: z.string().length(2).optional(),
  city: z.string().max(100).optional(),
  address: z.string().max(500).optional(),
  baseCurrency: z.string().length(3).optional(),
  defaultTaxPct: z.number().min(0).max(100).optional(),
})

export type UpdateUserProfileInput = z.infer<typeof updateUserProfileSchema>
export type UpdateOrganizationInput = z.infer<typeof updateOrganizationSchema>
```

**Export from `packages/validators/src/index.ts`:**
```typescript
export * from './settings'
```

#### 11. Update Translations

**File:** `apps/web/messages/es.json` (UPDATE)

```json
{
  "settings": {
    "settings": "ConfiguraciÃ³n",
    "profile": "Perfil",
    "organization": "OrganizaciÃ³n",
    "team": "Equipo",
    "notifications": "Notificaciones",
    "subscription": "SuscripciÃ³n",
    "security": "Seguridad",
    "preferences": "Preferencias",
    "billing": "FacturaciÃ³n",
    
    "fullName": "Nombre Completo",
    "email": "Correo ElectrÃ³nico",
    "language": "Idioma",
    "timezone": "Zona Horaria",
    "uploadAvatar": "Subir Foto",
    "avatarHelp": "JPG, PNG o GIF. MÃ¡ximo 2MB.",
    "emailNotEditable": "El email no se puede cambiar",
    
    "organizationName": "Nombre de la OrganizaciÃ³n",
    "legalName": "RazÃ³n Social",
    "slug": "Identificador",
    "slugNotEditable": "El identificador no se puede cambiar",
    "legalNameHelp": "Nombre legal para documentos fiscales",
    "taxId": "CUIT / RUT / RFC",
    "country": "PaÃ­s",
    "city": "Ciudad",
    "address": "DirecciÃ³n",
    "baseCurrency": "Moneda Base",
    "defaultTaxPct": "IVA / Impuesto (%)",
    "defaultTaxPctHelp": "Porcentaje de impuesto por defecto para nuevos presupuestos",
    
    "basicInfo": "InformaciÃ³n BÃ¡sica",
    "taxInfo": "InformaciÃ³n Fiscal",
    "financialDefaults": "ConfiguraciÃ³n Financiera",
    
    "member": "Miembro",
    "role": "Rol",
    "status": "Estado",
    "joined": "Se uniÃ³",
    "actions": "Acciones",
    "active": "Activo",
    "inactive": "Inactivo",
    "resendInvite": "Reenviar InvitaciÃ³n",
    "deactivate": "Desactivar",
    
    "role_owner": "Propietario",
    "role_admin": "Administrador",
    "role_editor": "Editor",
    "role_accountant": "Contador",
    "role_viewer": "Visualizador",
    
    "saveChanges": "Guardar Cambios",
    "cancel": "Cancelar",
    "saving": "Guardando...",
    
    "profileUpdated": "Perfil actualizado correctamente",
    "organizationUpdated": "OrganizaciÃ³n actualizada correctamente",
    "errorUpdating": "Error al actualizar"
  }
}
```

---

### **Acceptance Criteria:**

âœ“ Settings sidebar shows different sections based on role
âœ“ User can update their profile (name, locale, timezone)
âœ“ Admin/Owner can update organization settings
âœ“ Admin/Owner can view team members
âœ“ Team table shows all members with roles and status
âœ“ Avatar placeholders work correctly
âœ“ All forms validate with Zod
âœ“ Success/error toasts appear
âœ“ Changes persist in database
âœ“ All text is translated to Spanish
âœ“ Responsive layout works

---

### **Testing:**

1. Navigate to `/settings/profile`
2. Update name and locale
3. Save â†’ Should show success toast
4. Navigate to `/settings/organization` (as Admin/Owner)
5. Update organization data
6. Save â†’ Should persist
7. Navigate to `/settings/team`
8. View team members table
9. Test role-based visibility (settings sidebar items)

---

### **Don't:**

- Don't implement avatar upload yet (use placeholder)
- Don't implement email invitations yet (create placeholder)
- Don't implement billing/subscription pages
- Don't implement role changing yet
- Don't implement member deactivation yet

---

**This completes the Settings module foundation!**

Next prompts (24-26) will cover Team pages, Inventory, and Suppliers. Let me know when ready!